@using ITGWebTimeSheet2.Models

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InterWest Human Resources Portal</title>
    <link rel="icon" href="@Url.Content("~/Content/Images/ITG_Brand.gif")">

    <link rel="stylesheet" href="@Url.Content("~/Content/main.css")">

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">
    <link rel="stylesheet" href="@Url.Content("~/Content/fontawesome.min.css.css")">
    <link rel="stylesheet" href="@Url.Content("~/Content/Bootstrap-4---Tabs-with-Arrows.css")">
    <link rel="stylesheet" href="@Url.Content("~/Content/iframe.css")">
    <link rel="stylesheet" href="@Url.Content("~/Content/table.css")">
    <link rel="stylesheet" href="@Url.Content("~/Content/login.css")">
    <link rel="stylesheet" href="@Url.Content("~/Content/menubtn.css")">
    <link rel="stylesheet" href="@Url.Content("~/Content/bootstrap-datetimepicker.min.css")">
    <link rel="stylesheet" href="http://www.inputpicker.com/src/jquery.inputpicker.css?1588061795">

    <link rel="stylesheet" href="https://formden.com/static/cdn/font-awesome/4.4.0/css/font-awesome.min.css" />

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="@Url.Content("~/Scripts/ckeditor/ckeditor.js")"></script>
    <script src="https://kit.fontawesome.com/1b585ee530.js" crossorigin="anonymous"></script>

    <link href="@Url.Content("~/Content/jquery.timepicker.css")" rel="stylesheet" />

    <link href="@Url.Content("~/Content/jquery-confirm.css")" rel="stylesheet" />

    <sytle>
        .datepicker5
        {
        width: fit-content;
        }

        .modal-dialog {

        width: 1200px; /* New width for default modal */

        }
    </sytle>


</head>
<body class="app sidebar-mini sidenav-toggled">
    <!-- Navbar-->
    <header class="app-header">
        <a class="app-header__logo" href="#"></a>
        <!-- Sidebar toggle button
        <a class="app-sidebar__toggle" href="#" data-toggle="sidebar" aria-label="Hide Sidebar"></a> -->
        <!-- Navbar Right Menu-->
        <ul class="app-nav">

            <!--Notification Menu-->
            <!-- End Notification Menu-->
            <!-- User Menu-->
            <li class="dropdown">
                <a class="app-nav__item" href="#" data-toggle="dropdown" aria-label="Open Profile Menu"><i class="fa fa-user fa-lg"></i></a>&nbsp;&nbsp;&nbsp;&nbsp;
                <ul class="dropdown-menu settings-menu dropdown-menu-right">

                    <li><a class="dropdown-item" href="~/Default/Logout"><i class="fa fa-sign-out fa-lg"></i> Logout</a></li>
                </ul>
            </li>
        </ul>
    </header>
    <!-- Sidebar menu
    <div class="app-sidebar__overlay" data-toggle="sidebar"></div> -->

    <aside class="app-sidebar">
        <div class="app-sidebar__user">
            <img class="app-sidebar__user-avatar" src="~/Content/Images/rsz_interwest_logo.png" alt="User Image">
            <div>
                <p class="app-sidebar__user-name">Admin</p>
                <p class="app-sidebar__user-designation">Administrator</p>
            </div>
        </div>
        <ul class="app-menu">

            @{
                DayOfWeek firstWeekDay = System.Globalization.CultureInfo.CurrentCulture.DateTimeFormat.FirstDayOfWeek;

                DateTime startDateOfWeek = DateTime.Now;
                while (startDateOfWeek.DayOfWeek != firstWeekDay) { startDateOfWeek = startDateOfWeek.AddDays(-1d); }
                DateTime edow = startDateOfWeek.AddDays(6d);

                string param = "ed=" + startDateOfWeek.ToString("yyyy-MM-dd") + "&startDate=" + startDateOfWeek.ToString("yyyy-MM-dd") + "&endDate=" + edow.ToString("yyyy-MM-dd") + "&resourceId=" + ViewBag.ResourceId;
                param.Replace("-", "/");
            }

            <li><a class="app-menu__item" href="~/Default/Timesheet?@param"><i class="app-menu__icon fa fa-dashboard"></i><span class="app-menu__label">Timesheet</span></a></li>
            <li><a class="app-menu__item" href="#"><i class="app-menu__icon fa fa-calendar-times"></i><span class="app-menu__label">Version Info</span></a></li>


        </ul>
    </aside>
    <div>
        @RenderBody()
    </div>
    <script src="@Url.Content("~/Scripts/jquery.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery-confirm.js")"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="@Url.Content("~/Scripts/bootstrap.min.js")"></script>
    <script src="@Url.Content("~/Scripts/clean-blog.js")"></script>
    <script src="@Url.Content("~/Scripts/SearchTable.js")"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="@Url.Content("~/Scripts/main.js")"></script>

    <script type="text/javascript" src="@Url.Content("~/Scripts//jquery.dataTables.min.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/Scripts/dataTables.bootstrap.min.js")"></script>

    <script type="text/javascript">$('#sampleTable').DataTable();</script>


    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")"></script>

    <script src="@Url.Content("~/Scripts/popper.min.js")"></script>
    <script src="http://www.inputpicker.com/src/jquery.inputpicker.js"></script>

    <script src="@Url.Content("~/Scripts/jquery.weekpicker.min.js")"></script>
    <script src="@Url.Content("~/Scripts/jquery.timepicker.js")"></script>

    <script src="@Url.Content("~/Scripts/jquery.session.js")"></script>




    <script>
        $('.datepicker3').datepicker({
            uiLibrary: 'bootstrap4',
            format: 'mm/dd/yyyy',
            formatSubmit: 'mm/dd/yyyy',
        });
        $('.datepicker4').datepicker({
            uiLibrary: 'bootstrap4',
            format: 'mm/dd/yyyy',
            formatSubmit: 'mm/dd/yyyy',
        });
        $('#testweek').weekpicker();
    </script>


    <script>
        //--------------- modal for add files -----------------------
        $('#exampleModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever') // Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
        });

        $('#ssModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var recipient = button.data('whatever') // Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)
            modal.find('.modal-title').text('New message to ' + recipient)
            modal.find('.modal-body input').val(recipient)
        })



    </script>

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Add Files</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <input class="form-control" type="file" id="fileInput1" multiple>
                        </div>
                        <div class="form-group">
                            <button type="button" id="filesubmit" class="btn btn-primary" data-dismiss="modal">Submit</button>
                        </div>

                    </form>
                </div>

            </div>
        </div>
    </div>
    <div class="modal fade" id="ssModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Screenshot</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>

                        <div class="form-group">
                            <button type="button" id="ss" class="btn btn-primary">Paste Image</button>
                        </div>
                        <textarea id="pasteArea" placeholder="Paste Image Here"></textarea>
                        <img id="pastedImage" />

                    </form>
                </div>

            </div>
        </div>
    </div>


    <script>
        var lastid = 0;

        var dy2 = '<tr class="record" id="row_0" class="rowtoClick"> <td style="background-color: white;border-top-color: white;border-bottom-color: white;border-left-color: white;">';
        dy2 = dy2 + '<a href="#" id="toogle_0" class="dplay" style="margin-top:25px;"><i class="fas fa-play"></i></a>';

             dy2 = dy2 +'<a href="#" id="d_0"  class="down_arrow"><i class="fas fa-sort-down fa-2x" style="color:#5fac11;"></i></a>';
             dy2 = dy2 +'</td>';
        dy2 = dy2 +'<td style="border: 1px solid #dee2e6;" id="tdcust_0" class="tdnote"> <span id="custtask_0" class="task_input2">Click to select</span> <input type="hidden" id="custid_0"  />';
        dy2 = dy2 + '<td id="tdproj_0" class="tdnote"><span id="taskproj_0" class="task_input2"></span> <input type="hidden" id="projid_0" /> </td>';
        dy2 = dy2 + '<td id="tdtask_0" class="tdnote"> <span id="descriptiontask1_0" class="task_input2"></span><input type="hidden" id="taskid_0" /></td >';
        dy2 = dy2 + '<td id="tdnote_0" class="tdnote"><span id="notetask_0" class="task_input2">Add comment</span> <span id="selnote_0" class="sel_cust" style="display: none;"> <textarea id="notetask2_0" class="autoExpand form-control task_input" rows="1" data-min-rows="1" placeholder="description" name="description" maxlength="250">Add comment</textarea> </span></td>';
        dy2 = dy2 + '<td id="tdstart_0" class="tdnote"><span id="taskstart_0" class="task_input2">@ViewData["SystemDate"]</span> <span id="selstart_0" class="sel_stat" style="display: none;"> <input class="datepicker5" id="starttask_0" type="text" value="@ViewData["SystemDate"]" /> </span> </td >';
        dy2 = dy2 + '<td id="tdest_0" class="tdnote">';
             dy2 = dy2 + '<span id="taskest_0" class="task_input2">0.00</span><span id="selest_0" class="sel_cust" style="display: none;">';
        dy2 = dy2 + '<input id="esttask_0" class="form-control task_input" type="text" value="0.00" /></span> </td>';

      //  dy2 = dy2 + ' <td id="tdrtc_0" class="tdnote"> <span id="taskrtc_0" class="task_input2"></span> <span id="selrtc_0" class="sel_cust" style="display: none;"></span> </td>';
        dy2 = dy2 + '</tr>';

    //    dy2 = dy2 + '<td id="tdstime_0" class="tdnote"> <span id="taskstime_0" class="task_input2">Set time</span> <span id="selstime_0" class="sel_cust" style="display: none;"> <input id="eststime_0" class="timepicker89" type="text" /> </span> </td> <td> <span id="taskftime_0" class="task_input2"></span> </td>';
     //   dy2 = dy2 + '<td id="tdtaskstatus_0" class="tdnote"> <span id="taskstatus_0" class="task_input2">In Progress</span></td></tr>';
        dy2 = dy2 + '<tr class="notShow hideall" id="secondrow_0" style="display:none"><td style="background-color: white;border-top-color: white;border-bottom-color: white;border-left-color: white;"><a href="#" id="remove_0" class="remove_field2" style="position:relative;top: 62px;"><i class="fas fa-minus-circle"></i></a></td>';

        dy2 = dy2 + '<td colspan = "6" > <div class="row3"> <div style="position:relative;height:150px;padding: 10px 10px 10px 10px; " class="w-29"> <div style="float:left;" class="w-100"> <div style="float:left"><strong>Requirements:</strong><br /></div> <div style="float:right"> 04/21/2020 </div> </div> <div style="position:absolute;bottom: 5px;font-size: 9px;right: 10px;"> <a href="#"><i class="fas fa-external-link-alt fa-2x"></i></a> </div> </div> <div class="w-1"> </div>';

      //  dy2 = dy2 + '<div style="background-color:white;position:relative;height:150px;padding: 10px 10px 10px 10px; " class="w-29"> <div style="float:left;" class="w-100">';


       // dy2 = dy2 + '<div class="td-main" style="float:left; display: block; width: 100%;"> Subtasks:<br /> <pre id="notetask3_0" class="td-label"></pre> <span id="selnote_0" class="td-control" data-type="txt" data-field="notes" style="display: none;"> <textarea id="notetask2_0" style=" display: block; width: 100%; height: 80%;" class="form-control td-txt" rows="4" data-min-rows="4" placeholder="description" name="description"></textarea> </span> </div>';

        dy2 = dy2 + ' <div style="background-color:white;position:relative;min-height:150px; height: auto;border: 1px solid #dee2e6; padding: 10px 10px 10px 10px;" class="w-29 td-main"> <div style="float:left;" class="w-100"> <div style="float:left; display: block; width: 100%;"> Subtask v2: &nbsp;<a id="add_subtask_0_p" href="#" class="subtasklist"><i class="fas fa-plus-circle"></i></a>&nbsp;&nbsp; <a id="save_subtask_0_p" href="#" style="display:none" class="savetasklist"><i class="fas fa-save"></i></a> <div style="height:101px;overflow-y: auto;" id="divlist_0"> <ul class="list-group checked-list-box" id="tasklist_0"> </ul>';
        dy2 = dy2 + '</div> <span id="selnote2_0" style="display: none;"> <textarea id="subtaskinfo_0" style=" display: block; width: 100%; height: 80%;" class="form-control " rows="4" data-min-rows="4" placeholder="description" name="description"></textarea> </span> </div> <div style="float:right"> </div> </div> <div style="float:left;" class="w-100"> <div style="position:absolute;bottom: 5px;font-size: 11px;background-color: #002080;color:white;height:20px;width:304px;display:block"> <span style="float:left;margin-left:5px;"><strong>Status: </strong></span> <span style="float:right;margin-right:5px"><a href="#" style="color:white" class="loadallsubtask" id="allsubtask_p"><i class="fas fa-external-link-alt"></i></a></span> </div> </div> </div>';


        //   dy2 = dy2 + '<div style="float:right"></div> </div> <div style="position:absolute;bottom: 5px;font-size: 9px;right: 10px;"> <a href="#"><i class="fas fa-external-link-alt fa-2x"></i></a> </div> </div> <div class="w-29"> </div> <div class="w-1"> </div> <div class="w-10"> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">History / Notes</button> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Files</button> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Images</button> </div> </div > </td > </tr > ';
      //  dy2 = dy2 + '<div style="float:right"></div> </div> <div style="position:absolute;bottom: 5px;font-size: 9px;right: 10px;"> <a href="#"><i class="fas fa-external-link-alt fa-2x"></i></a> </div> </div>';
        dy2 = dy2 + '<div class="w-29" > </div > <div class="w-1"> </div> <div class="w-10"> <button type="button" class="btn btn-success w-100 savetask24" style="margin-bottom:5px;" id="save_0">Save</button><button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Notes</button> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Files</button> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Images</button> </div> </div > </td > </tr > ';

             //--------------- start to dynamic layout ------

             $('body').on('click','.add_fields3', function () {
                if ($('#row_0').length)         // use this if you are using id to check
                {
                  //  alert("The newly added row is not yet save. Please select customers to save it.")
                    if (confirm("Do you want to quit the current record? Information will be lost. Yes / No")) {
                        $("#row_0").fadeOut("slow", function () {
                            // After animation completed:
                            $("#row_0").remove();
                            $("#secondrow_0").remove();
                        });
                    }
                }
                else {

                    $('#taskmantable tbody').prepend(dy2);

                    bugsolve();
                    $('.hideall').hide();
                    $('.down_arrow').hide();

                    $('[id^=secondrow_]').each(function () {
                        $(this).hide();
                    });

                    $('[id^=remove_]').each(function () {
                        $(this).hide();
                    });

                    $('[id^=toogle_]').each(function () {
                        $(this).show();
                    });



                   // $('#toogle_0').hide();
                  //      $('#remove_0').show();
                 //       $('#d_0').show();
                //    $('#toogle_0').hide();
                 //   $('#secondrow_0').show();

                    $('#toogle_0').show();





                    if (lastid !== 0) {
                       // alert("test");
                     //   $('#toogle_' + lastid).show();
                     //   alert(lastid);
                    }

                }
             });


    </script>
    <script>
        $(function () {
            $(".datepicker99").datepicker();
            $(".timepicker99").timepicker();
            $(".datepicker79").datepicker();


            $(".datepicker-timesheet-previous").datepicker();
            $(".datepicker-timesheet-next").datepicker();

        });
        // ---------------------- hide control and elements ------------------------
        $(document).ready(function () {
            bindEdit();
        });
        $(document).ajaxComplete(function (event, xhr, settings) {
            bindEdit();
        });

        function bindEdit() {


            $(".cust_name").hide();  // hide all inputs for customer name edit section
            $(".savecustomers").hide();  // the save button
            $(".proj_name").hide();
            $(".saveproj").hide();

            $(".staff1_name").hide();
            $(".staff2_name").hide();
            $(".staff3_name").hide();
            $(".savestaff1").hide();
            $(".savestaff2").hide();
            $(".savestaff3").hide();

            $(".sel_resc").hide();
            $(".sel_staff").hide();
            $(".sel_pr").hide();
            $(".sel_stat").hide();

            $

            $("body").tooltip({ selector: '[data-toggle=tooltip]' });
            $(".sel_cust").hide();   // hide customer dropdown
        }

        $('body').on('click', '.dplay', function (e) {
            checktdnote();

             $('.hideall').hide();

             //------
             $('.sel_cust').hide();
             $('.sel_cus').hide();
             $('.sel_stat').hide();
             $('.task_input2').show();
            //------

            var element = $(this);
            var id_string = element.attr("id");
            console.log(id_string);
            var del_id = id_string.split("_");
            var info = 'id=' + del_id[1];


            $('[id^=d_]').each(function () {
                $(this).hide();
            });


            $('[id^=toogle_]').each(function () {
              //  $(this).removeClass('remove_field2').addClass('dplay');
                $(this).show();
            });

            $('[id^=remove_]').each(function () {
                $(this).hide();
            });

            //enable delete field remove
            $('#toogle_' + del_id[1]).hide();
            $('#remove_' + del_id[1]).show();
            $('#d_' + del_id[1]).show();

            $('#secondrow_' + del_id[1]).show();

            e.preventDefault();
            e.stopPropagation();
            return false;

        });

        $('body').on("click", ".remove_field2", function (e) {
            e.preventDefault();

            //------
            $('.sel_cust').hide();
            $('.sel_cus').hide();
            $('.sel_stat').hide();
            $('.task_input2').show();
            //------

            var element = $(this);

            var id_string = element.attr("id");

            var del_id = id_string.split("_");
            var info = 'id=' + del_id[1];


            let tr = $('#row_' + del_id[1]);
            console.log(info);

                 $.confirm({
                title: 'Hey!',
                content: 'Are you sure you want to delete this Record?"',
                icon: 'fa fa-question-circle',
                animation: 'scale',
                closeAnimation: 'scale',
                opacity: 0.5,
                buttons: {
                    'confirm': {
                        text: 'Proceed',
                        btnClass: 'btn-blue',
                        action: function () {
                                             $.ajax({
                                                type: "GET",
                                                url: "@Url.Action("DeleteTaskList")",
                                                data: info,
                                                success: function () {

                                                }
                                            });
                                            $("#row_" + del_id[1]).fadeOut("slow", function () {
                                                // After animation completed:
                                                $("#row_" + del_id[1]).remove();
                                                $("#secondrow_" + del_id[1]).remove();
                                            });
                                            var theTotal = 0;
                                            $('[id^=taskest_]').each(function () {
                                                var val = $(this).text().replace(" ", "").replace(",-", "");
                                                theTotal += parseFloat(val);
                                            });

                                            console.log(theTotal);
                                            $("#totalhours").html(theTotal);
                        }
                    },
                    cancel: function () {
                      //  $.alert('you clicked on <strong>cancel</strong>');
                    },

                }
            });







            @*if (confirm("Are you sure? This cannot be undone Yes / No")) {
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("DeleteTaskList")",
                    data: info,
                    success: function () {

                    }
                });
                $("#row_" + del_id[1]).fadeOut("slow", function () {
                    // After animation completed:
                    $("#row_" + del_id[1]).remove();
                    $("#secondrow_" + del_id[1]).remove();
                });
                var theTotal = 0;
                $('[id^=taskest_]').each(function () {
                    var val = $(this).text().replace(" ", "").replace(",-", "");
                    theTotal += parseFloat(val);
                });

                console.log(theTotal);
                $("#totalhours").html(theTotal);
            } // end confirm*@

        });
        $("body").on('click', '.down_arrow', function (e) {
            checktdnote();
            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");

            var control_name = del_id[0];
            console.log(id_string);

            $('.hideall').hide();

            //------
            $('.sel_cust').hide();
            $('.sel_cus').hide();
            $('.sel_stat').hide();
            $('.task_input2').show();
            //------

            $('#secondrow_' + del_id[1]).hide();

            $('#toogle_' + del_id[1]).show();
            $('#remove_' + del_id[1]).hide();
            $('#d_' + del_id[1]).hide();

            $('[id^=toogle_]').each(function () {
                //  $(this).removeClass('remove_field2').addClass('dplay');
                $(this).show();
            });

            e.preventDefault();
            e.stopPropagation();
            return false;
        });

        $("body").on('click', '.tdnote', function (e) {

            bugsolve();
            checktdnote();

            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");

            var control_name = del_id[0];
            console.log(id_string);


            $('.hideall').hide();


            //------
            $('.sel_cust').hide();
            $('.sel_cus').hide();
            $('.sel_stat').hide();
            $('.task_input2').show();
            //------

            $('#secondrow_' + del_id[1]).show();


            $('[id^=d_]').each(function () {
                $(this).hide();
            });


            $('[id^=toogle_]').each(function () {

                $(this).show();
            });

            $('[id^=remove_]').each(function () {
                $(this).hide();
            });

            //enable delete field remove
            $('#toogle_' + del_id[1]).hide();
            $('#remove_' + del_id[1]).show();
            $('#d_' + del_id[1]).show();


            if (control_name == "tdtaskstatus") {
                console.log(control_name);
                //  $('#selstatus_' + del_id[1]).remove();
                $('#tdtaskstatus_' + del_id[1]).removeClass('tdnote');
                $('#selstatus_' + del_id[1]).remove();

                var tm7 = element.find('span').text();

                //----------------------------
                var numbers = ["In Progress", "Ready to Close", "Issue"];

                var op1 = '';
                var op = '';
                for (var i = 0; i < numbers.length; i++) {
                    var d2 = numbers[i];

                    if (tm7.trim() != d2) {
                        op = op + "<option value='" + d2 + "'>" + d2 + '</option>';
                    }
                    else {
                        op1 = "'<option value='" + d2 + "'>" + d2 + '</option>';
                    }

                }
                var op2 = '<option value="" disabled selected style="display:none;">' + tm7 + '</option>';
                var me = '';
                me = '<span id="selstatus_' + del_id[1] + '" class="sel_cust">';
                me = me + '<select class="form-control savetask2" id="m2stat_' + del_id[1] + '">';
                me = me + op2 + op1 + op;
                //  me = me  + op1 + op;
                me = me + '</select></span>';


                $('#taskstatus_' + del_id[1]).hide();
                $(me).insertAfter('#taskstatus_' + del_id[1]);
                //  $('#selectcust_' + del_id[1]).prepend(op2);

                $('#m2stat_' + del_id[1]).val('');
                // element.find('span').text('');



                //-------------------------


            }



            if (control_name == "tdcust") {
                //------------------- get data from  sql server ----



               console.log(control_name);
               $('#selcust_' + del_id[1]).remove();
               $('#tdcust_' + del_id[1]).removeClass('tdnote');

              var tm2= element.find('span').text();



                         $.ajax({
                         type: "GET",
                         url: "@Url.Action("ShowCustWithProj")",
                              dataType: "text",
                              success: function (data) {

                            var numbers =data.split('^');
                                //  var op = '<option value="0">Select Customer</option>';
                                //  var op = '<option value="">' + tmp + '</option>';


                                  var op1 = '';
                                  var op = '';
                            for (var i = 0; i < numbers.length-1; i++) {
                             var d2 = numbers[i].split(':')

                                if (tm2.trim() != d2[1]) {
                                    op = op + '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                else {
                                    op1 = '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }

                                  }
                                  var op2 = '<option value="" disabled selected style="display:none;">' + tm2 + '</option>';
                                  var me = '';
                                  me = '<span id="selcust_' + del_id[1] + '" class="sel_cust">';
                                  me = me + '<select class="form-control savetask2" id="selectcust_' + del_id[1] + '">';
                                  me = me   + op2 + op1 + op;
                                //  me = me  + op1 + op;
                                  me = me + '</select></span>';


                                  $('#custtask_' + del_id[1]).hide();
                                  $(me).insertAfter('#custtask_' + del_id[1]);
                                //  $('#selectcust_' + del_id[1]).prepend(op2);

                                  $('#selectcust_' + del_id[1]).val('');
                                 // element.find('span').text('');


                },
                error: function (xhr) {
                    alert('error customer');
                }
            });


            }
            if (control_name == "tdproj") {



                $('#tdproj_' + del_id[1]).removeClass('tdnote');
                $('#selproj_' + del_id[1]).remove();
              //  $('#taskproj_' + del_id[1]).hide();// show control

                var tm3 = element.find('span').text();


                console.log("tm3:" + tm3)

                //---------------------------------------------------------------
                 var cust_id = $('#custid_' + del_id[1]).val();
                 $.ajax({
                        type: "GET",
                         url: "@Url.Action("ShowProject")",
                     dataType: "text",
                     data: "id=" + cust_id,
                              success: function (data) {


                                  var numbers = data.split('^');

                                 numbers = getUnique(numbers);

                                 // var op = '<option value="0">Select Project</option>';


                                  var op1 = '';
                                  var op = '';
                                  var op2 = '';
                            for (var i = 0; i < numbers.length-1; i++) {
                             var d2 = numbers[i].split(':')


                                if (tm3.trim() != d2[1]) {
                                    op = op + '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                else {
                                    if (tm3.trim() !== "") {
                                        op1 = '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                    }

                                }

                                  }


                                  console.log("op1:" + op1);
                                  console.log("op:" + op);
                                  op2 = '<option value="" disabled selected style="display:none;">' + tm3 + '</option>';
                                  var me = '';
                                //  var op2 = '<option value="" disabled selected style="display:none;">' + tm2 + '</option>';
                                  me = '<span id="selproj_' + del_id[1] + '" class="sel_cust">';
                                  me = me + '<select class="form-control savetask2" id="selectproj_' + del_id[1] + '">';
                                  me = me + op2 + op1 + op;
                                  me = me + '</select></span>';
                                  console.log(me);

                                  $('#taskproj_' + del_id[1]).hide();
                                  $(me).insertAfter('#taskproj_' + del_id[1]);

                                  $('#selectproj_' + del_id[1]).val('');
                                 // element.find('span').text('');
                },
                error: function (xhr) {
                    alert('error getting project list');
                }
            });
            }
            if (control_name == "tdtask") {



                $('#tdtask_' + del_id[1]).removeClass('tdnote');
                $('#seldesc_' + del_id[1]).remove();                // show control
              //  $('#descriptiontask1_' + del_id[1]).hide();


                var tm4 = element.find('span').text();


                var cust_id = $('#custid_' + del_id[1]).val();
                var proj_id = $('#projid_' + del_id[1]).val();
                 $.ajax({
                        type: "GET",
                         url: "@Url.Action("ShowTaskList")",
                     dataType: "text",
                     data: "custid=" + cust_id + "&projid=" + proj_id,
                              success: function (data) {

                              //    alert(data);
                            var numbers =data.split('^');
                               //   var op = '<option value="0">Select Task</option>';


                                  var op1 = '';
                                  var op = '';


                            for (var i = 0; i < numbers.length-1; i++) {
                             var d2 = numbers[i].split(':::')

                                if (tm4.trim() !== d2[1]) {
                                    op = op + '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                else {
                                    op1 = '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                  }

                                  var op2 = '<option value="" disabled selected style="display:none;">' + tm4 + '</option>';
                                  var me = '';
                                  me = '<span id="seldesc_' + del_id[1] + '" class="sel_cust">';
                                  me = me + '<select class="form-control savetask2" id="selecttask_' + del_id[1] + '">';
                                  me = me + op2 + op1 + op;
                                  me = me + '</select></span>';
                                  console.log(me);

                                  $('#descriptiontask1_' + del_id[1]).hide();
                                  $(me).insertAfter('#descriptiontask1_' + del_id[1]);

                                  $('#selecttask_' + del_id[1]).val('');
                },
                error: function (xhr) {
                    alert('error customer');
                }
            });
            }


            if (control_name == "tdnote") {

                $('#selnote_' + del_id[1]).show();                // show comment
                $('#notetask_' + del_id[1]).hide();

                $.session.set("prevdate", $('#taskstart_' + del_id[1]).text());
               // alert($.session.get("prevdate"));

             //   $('#starttask_' + del_id[1]).text($.session.get("prevdate"))
            }
            if (control_name == "tdstart") {
                // store session value

                $.session.set("prevdate", $('#taskstart_' + del_id[1]).text());
             //   $('#starttask_' + del_id[1]).text($.session.get("prevdate"))
                $('#selstart_' + del_id[1]).show();               // start date
                //   $('#starttask_' + del_id[1]).addClass('.datepicker99');
                $('#taskstart_' + del_id[1]).hide();
            }


            if (control_name == "tdest") {
                $('#selest_' + del_id[1]).show();                // show control
                $('#taskest_' + del_id[1]).hide();
            }


            if (control_name == "tdstime") {
                $('#selstime_' + del_id[1]).show();                // show control
                $('#taskstime_' + del_id[1]).hide();

            }


            //------------------------
            e.preventDefault();
            e.stopPropagation();
            return false;
        });

        $("body").on('click', '.task_input2', function () {

            bugsolve();

            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");

            var control_name = del_id[0];
            console.log(id_string);

            bugsolve();
            $('.hideall').hide();


            //------
            $('.sel_cust').hide();
            $('.sel_cus').hide();
            $('.sel_stat').hide();
            $('.task_input2').show();
            //------

            $('#secondrow_' + del_id[1]).show();


            $('[id^=d_]').each(function () {
                $(this).hide();
            });


            $('[id^=toogle_]').each(function () {

                $(this).show();
            });

            $('[id^=remove_]').each(function () {
                $(this).hide();
            });

            //enable delete field remove
            $('#toogle_' + del_id[1]).hide();
            $('#remove_' + del_id[1]).show();
            $('#d_' + del_id[1]).show();



            var tmp = element.text();

            if (control_name == "custtask1") {
                //------------------- get data from  sql server ----

                console.log(control_name);
                $('#selcust_' + del_id[1]).remove();


             //   alert(tmp);
                console.log(tmp);

                          $.ajax({
                        type: "GET",
                         url: "@Url.Action("ShowCustWithProj")",
                              dataType: "text",
                              success: function (data) {

                            var numbers =data.split('^');
                                //  var op = '<option value="0">Select Customer</option>';
                                //  var op = '<option value="">' + tmp + '</option>';

                                  var op2 = '<option value="" disabled selected style="display:none;">' + tmp +'</option>';
                                  var op1 = '';
                                  var op = '';
                            for (var i = 0; i < numbers.length-1; i++) {
                             var d2 = numbers[i].split(':')

                                if (tmp.trim() !== d2[1]) {
                                    op = op + '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                else {
                                    op1 = '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }

                                  }

                                  var me = '';
                                  me = '<span id="selcust_' + del_id[1] + '" class="sel_cust">';
                                  me = me + '<select class="form-control savetask2" id="selectcust_' + del_id[1] + '">';
                                  me = me + op2 + op1 + op;
                                  me = me + '</select></span>';


                                  $('#custtask_' + del_id[1]).hide();
                                  $(me).insertAfter('#custtask_' + del_id[1]);

                                  $('selectcust_' + del_id[1]).val('');


                },
                error: function (xhr) {
                    alert('error customer');
                }
            });


            }
            if (control_name == "taskproj1") {
                $('#selproj_' + del_id[1]).remove();
                $('#taskproj_' + del_id[1]).hide();// show control

                //---------------------------------------------------------------
                 var cust_id = $('#custid_' + del_id[1]).val();
                 $.ajax({
                        type: "GET",
                         url: "@Url.Action("ShowProject")",
                     dataType: "text",
                     data: "id=" + cust_id,
                              success: function (data) {


                            var numbers =data.split('^');
                                 // var op = '<option value="0">Select Project</option>';

                                  var op2 = '<option value="" disabled selected style="display:none;">' + tmp + '</option>';
                                  var op1 = '';
                                  var op = '';
                            for (var i = 0; i < numbers.length-1; i++) {
                             var d2 = numbers[i].split(':')


                                if (tmp.trim() !== d2[1]) {
                                    op = op + '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                else {
                                    if (tmp.trim() !== "") {
                                        op1 = '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                    }
                                }



                                  }
                                  console.log(op1);
                                  console.log(op);
                                  var me = '';
                                  me = '<span id="selproj_' + del_id[1] + '" class="sel_cust">';
                                  me = me + '<select class="form-control savetask2" id="selectproj_' + del_id[1] + '">';
                                  me = me + op2 + op1 + op;
                                  me = me + '</select></span>';
                                  console.log(me);

                                  $('#taskproj_' + del_id[1]).hide();
                                  $(me).insertAfter('#taskproj_' + del_id[1]);
                },
                error: function (xhr) {
                    alert('error getting project list');
                }
            });
            }
            if (control_name == "descriptiontask11_") {
                $('#seldesc_' + del_id[1]).remove();                // show control
                $('#descriptiontask1_' + del_id[1]).hide();


                var cust_id = $('#custid_' + del_id[1]).val();
                var proj_id = $('#projid_' + del_id[1]).val();
                 $.ajax({
                        type: "GET",
                         url: "@Url.Action("ShowTaskList")",
                     dataType: "text",
                     data: "custid=" + cust_id + "&projid=" + proj_id,
                              success: function (data) {

                              //    alert(data);
                            var numbers =data.split('^');
                               //   var op = '<option value="0">Select Task</option>';

                                  var op2 = '<option value="" disabled selected style="display:none;">' + tmp + '</option>';
                                  var op1 = '';
                                  var op = '';


                            for (var i = 0; i < numbers.length-1; i++) {
                             var d2 = numbers[i].split(':')

                                if (tmp.trim() !== d2[1]) {
                                    op = op + '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                else {
                                    op1 = '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                  }

                                  var me = '';
                                  me = '<span id="seldesc_' + del_id[1] + '" class="sel_cust">';
                                  me = me + '<select class="form-control savetask2" id="selecttask_' + del_id[1] + '">';
                                  me = me + op2 + op1 + op;
                                  me = me + '</select></span>';
                                  console.log(me);

                                  $('#descriptiontask1_' + del_id[1]).hide();
                                  $(me).insertAfter('#descriptiontask1_' + del_id[1]);
                },
                error: function (xhr) {
                    alert('error customer');
                }
            });
            }
            if (control_name == "taskresc") {
                $('#selresc_' + del_id[1]).show();                // show control
                $('#taskresc_' + del_id[1]).hide();
            }
            if (control_name == "taskstaff") {
                $('#selstaff_' + del_id[1]).show();                // show control
                $('#taskstaff_' + del_id[1]).hide();
            }
            if (control_name == "taskpr") {
                $('#selpr_' + del_id[1]).show();
                $('#taskpr_' + del_id[1]).hide();    // show control
            }
            if (control_name == "taskstart2") {
                $('#selstart_' + del_id[1]).show();               // start date
                //   $('#starttask_' + del_id[1]).addClass('.datepicker99');
                $('#taskstart_' + del_id[1]).hide();
            }
            if (control_name == "taskfinish") {
                $('#selfinish_' + del_id[1]).show();               // start date
            }


            if (control_name == "taskstat") {
                $('#selstat_' + del_id[1]).show();                // show control
                $('#taskstat_' + del_id[1]).hide();
            }
            if (control_name == "taskest2") {
                $('#selest_' + del_id[1]).show();                // show control
                $('#taskest_' + del_id[1]).hide();

            }
            if (control_name == "taskdev") {
                $('#seldev_' + del_id[1]).show();                // show control
                $('#taskdev_' + del_id[1]).hide();

            }
            if (control_name == "notetask") {
                $('#selnote_' + del_id[1]).show();                // show control
                $('#notetask_' + del_id[1]).hide();
            }
            if (control_name == "taskstime2") {
                $('#selstime_' + del_id[1]).show();                // show control
                $('#taskstime_' + del_id[1]).hide();

            }

        });


    </script>
    <script>
        // ---------------------- hide control and elements ------------------------
        $(document).ready(function () {
          //  bindEdit();
        });
        $(document).ajaxComplete(function (event, xhr, settings) {
          //  bindEdit();
        });

        function bindEdit() {


            $(".cust_name").hide();  // hide all inputs for customer name edit section
            $(".savecustomers").hide();  // the save button
            $(".proj_name").hide();
            $(".saveproj").hide();

            $(".staff1_name").hide();
            $(".staff2_name").hide();
            $(".staff3_name").hide();
            $(".savestaff1").hide();
            $(".savestaff2").hide();
            $(".savestaff3").hide();

            $(".sel_resc").hide();
            $(".sel_staff").hide();
            $(".sel_pr").hide();
            $(".sel_stat").hide();

            $("body").tooltip({ selector: '[data-toggle=tooltip]' });
          //  $(".sel_cust").hide();   // hide customer dropdown
        }


           $('body').on('change', '#selectcust_0', function (e) {

            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            console.log(id_string);
            var control_name = del_id[0];


                    var newval = $("#selectcust_" + del_id[1] + " option:selected").text();
                    var custid = $("#selectcust_" + del_id[1] + " option:selected").val();

                    $('#custtask_' + del_id[1]).text(newval);
                    $('#custtask_' + del_id[1]).show();

                       $.ajax({
                        type: "GET",
                       url: "@Url.Action("GetTimesheetScope")",
                        data: "id=" + custid,
                        dataType: "text",
                        success: function (data) {

                         //   alert("data:" + data);


                            $('#taskstatus_0').prop('id', 'taskstatus_' + data);
                            $('#tdtaskstatus_0').prop('id', 'tdtaskstatus_' + data);
                            $('#selstatus_0').prop('id', 'selstatus_' + data);
                            $('#selectstatus_0').prop('id', 'selectstatus_' + data);


                            $('tr#row_0').prop('id', 'row_' + data);
                            $('a#toogle_0').prop('id', 'toogle_' + data);
                            $('a#remove_0').prop('id', 'remove_' + data);
                            $('i#drop_0').prop('id', 'drop_' + data);
                            $('span#custtask_0').prop('id', 'custtask_' + data);
                            $('span#selcust_0').prop('id', 'selcust_' + data);
                            $('#selectcust_0').prop('id', 'selectcust_' + data);
                            $('#custid_0').prop('id', 'custid_' + data);
                            // pr
                            $('#taskpr_0').prop('id', 'taskpr_' + data);
                            $('#selpr_0').prop('id', 'selpr_' + data);
                            $('#selectpr_0').prop('id', 'selectpr_' + data);
                            $('#projid_0').prop('id', 'projid_' + data);
                            //project

                            $('#taskproj_0').prop('id', 'taskproj_' + data);
                            $('#selproj_0').prop('id', 'selproj_' + data);
                            $('#selectproj_0').prop('id', 'selectproj_' + data);
                            //task

                            $('#descriptiontask1_0').prop('id', 'descriptiontask1_' + data);
                            $('#seldesc_0').prop('id', 'seldesc_' + data);
                            $('#descriptiontask_0').prop('id', 'descriptiontask_' + data);
                            $('#taskid_0').prop('id', 'taskid_' + data);

                            //type
                            $('#taskdev_0').prop('id', 'taskdev_' + data);
                            $('#seldev_0').prop('id', 'seldev_' + data);
                            $('#selectdev_0').prop('id', 'selectdev_' + data);

                            // resource
                            $('#taskresc_0').prop('id', 'taskresc_' + data);
                            $('#selresc_0').prop('id', 'selresc_' + data);
                            $('#selectresc_0').prop('id', 'selectresc_' + data);

                            //stat
                            $('#taskstat_0').prop('id', 'taskstat_' + data);
                            $('#selstat_0').prop('id', 'selstat_' + data);
                            $('#selectstat_0').prop('id', 'selectstat_' + data);

                            //start
                            $('#taskstart_0').prop('id', 'taskstart_' + data);
                            $('#selstart_0').prop('id', 'selstart_' + data);
                            $('#starttask_0').prop('id', 'starttask_' + data);

                            //est
                            $('#taskest_0').prop('id', 'taskest_' + data);
                            $('#selest_0').prop('id', 'selest_' + data);
                            $('#esttask_0').prop('id', 'esttask_' + data);

                            //note
                            $('span#notetask_0').prop('id', 'notetask_' + data);
                            $('pre#notetask3_0').prop('id', 'notetask3_' + data);
                            $('span#selnote_0').prop('id', 'selnote_' + data);
                            $('#notetask2_0').prop('id', 'notetask2_' + data);

                            $('#d_0').prop('id', 'd_' + data);
                            $('#secondrow_0').prop('id', 'secondrow_' + data);

                            $('#taskstime_0').prop('id', 'taskstime_' + data);
                            $('#taskftime_0').prop('id', 'taskftime_' + data);
                            $('#selstime_0').prop('id', 'selstime_' + data);
                            $('#eststime_0').prop('id', 'eststime_' + data);

                            $('#tdnote_0').prop('id', 'tdnote_' + data);
                            $('#tdtask_0').prop('id', 'tdtask_' + data);
                            $('#tdproj_0').prop('id', 'tdproj_' + data);
                            $('#tdcust_0').prop('id', 'tdcust_' + data);

                            $('#tdstart_0').prop('id', 'tdstart_' + data);
                            $('#tdest_0').prop('id', 'tdest_' + data);
                            $('#tdstime_0').prop('id', 'tdstime_' + data);

                            //----------------------------------
                            $('#divlist_0').prop('id', 'divlist_' + data);

                            $('#add_subtask_0_p').prop('id', 'add_subtask_' + data + '_p');

                            $('#save_subtask_0_p').prop('id', 'save_subtask_' + data + '_p');

                            $('#tasklist_0').prop('id', 'tasklist_' + data);

                            $('#selnote2_0').prop('id', 'selnote2_' + data);

                            $('#subtaskinfo_0').prop('id', 'subtaskinfo_' + data);

                          //  $('#allsubtask_0').prop('id', 'allsubtask_' + data);
                            //-----------------------------------------

                            lastid = data;

                },
                error: function (xhr) {
                    alert('error');
                }
            });

        });


        $('.timepicker99').on("change", function () {

            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            console.log(id_string);
            var control_name = del_id[0];

            var custid = $(this).val();

            $("#taskstime_" + del_id[1]).html(custid);
            $('#selstime_' + del_id[1]).hide();
            $("#taskstime_" + del_id[1]).show();

            var ft = $("#taskest_" + del_id[1]).text();

            var info = 'id=' + del_id[1] + '&pid=' + custid + '&ft=' + ft;
            console.log(info)

            var url = "@Url.Action("UpdateStime")";




            $.ajax({
                type: "GET",
                url: url,
                data: info,
                success: function (data) {
                    //      location.reload(true);
                    $("#taskftime_" + del_id[1]).html(data);
                }
            });

        });

        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }


        $('#select_d').on("change input", function () {

            var custid = $(this).val();
            window.location.href = "@Url.Action("TimeSheet")?ed=" + custid + "&startDate=" + startDate + " &endDate=" + endDate;

        });

       $('#dtp_previous').on("change input", function () {
           var startDate = $('#dtp_previous').val();
           var endDate = $('#dtp_next').val();
           window.location.href = "@Url.Action("TimeSheet")?ed=&startDate=" + startDate + "&endDate=" + endDate + "&resourceId=" + getParameterByName('resourceId');

        });

       $('#dtp_next').on("change input", function () {
           var startDate = $('#dtp_previous').val();
           var endDate = $('#dtp_next').val();
           window.location.href = "@Url.Action("TimeSheet")?ed=&startDate=" + startDate + "&endDate=" + endDate + "&resourceId=" + getParameterByName('resourceId');
           $(".overlay").show();
        });


      $('body').on("change", ".datepicker99", function () {

          alert('hello');

              var prev = $(this).data('val');

           //   alert($(this).val());

            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            console.log(id_string);
            var control_name = del_id[0];

            var custid = $(this).val();


              var info = 'id=' + del_id[1] + '&pid=' + custid;

           //   $("#taskstart_" + del_id[1]).html(custid);
            console.log(info);

              var std = $('#startweekday').text();
              console.log("std:" + std);
                $.ajax({
                type: "GET",
                    url: "@Url.Action("CheckDate")",
                //  data: "refdate=" + custid,
                    data: "refdate=" + custid+ "&based="+std,
                    success: function (data) {
                        console.log("data:" + data);

                        //anything goes update date
                         var url = "@Url.Action("UpdateTimesheetEdate")";
                        if (data === "true") {

                                    $.ajax({
                                        type: "GET",
                                        url: url,
                                        data: info,
                                        success: function () {
                                            //      location.reload(true);
                                            $("#taskstart_" + del_id[1]).text(custid);

                                            console.log("DAte:" + custid);
                                        }
                            });

                        } else {

                            if (confirm("You are moving this record to another week. Are you sure? Yes / No")) {

                                    $.ajax({
                                        type: "GET",
                                        url: url,
                                        data: info,
                                        success: function (data2) {
                                            console.log("data2:" + data2);
                                            //      location.reload(true);
                                            $("#taskstart_" + del_id[1]).text(custid);
                                            $("#row_" + del_id[1]).fadeOut("slow", function () {
                                                // After animation completed:
                                                $("#row_" + del_id[1]).remove();
                                                $("#secondrow_" + del_id[1]).remove();
                                                 window.location.href = "@Url.Action("TimeSheet")?ed=" + custid;
                                            });
                                        }
                                });


                            } else {
                           $("#taskstart_" + del_id[1]).text($.session.get("prevdate"));
                                //---------- set date
                             //   $('#starttask_' + del_id[1]).datepicker()

                                $('#starttask_' + del_id[1]).datepicker({ dateFormat: 'mm/dd/yy' }).datepicker('setDate', $.session.get("prevdate"));

                              //  $('#datepicker').datepicker({ dateFormat: 'yy-mm-dd' }).datepicker('setDate', '2010-07-25');
                            }


                        }
                }
            });



              $('#selstart' + del_id[1]).hide();
              $("#taskstart_" + del_id[1]).show();



        });

       $("body").on('blur', '.task_input', function (e) {
                var element = $(this);
                var id_string = element.attr("id");
                var del_id = id_string.split("_");

             var control_name = del_id[0];
           console.log(id_string);


            if (control_name == "esttask") {
                var val2 = $("#esttask_" + del_id[1]).val();
                var dec = 0.25;


                if ((val2 / dec) % 1 == 0) {
                     $("#taskest_" + del_id[1]).html((parseFloat(val2).toFixed(2)));  //parseFloat($(this).val(custid)).toFixed(2)
                    var info = 'id=' + del_id[1] + '&pid=' + val2;
                    var url = "@Url.Action("UpdateTaskAct")";
                     $('#selest_' + del_id[1]).hide();
                     $("#taskest_" + del_id[1]).show();

                    // check if

                    if ($('#taskstime_' + del_id[1]).text() !== "Set time") {
                        var custid = $("#taskstime_" + del_id[1]).text();
                        var ft = $("#taskest_" + del_id[1]).text();
                        var info2 = 'id=' + del_id[1] + '&pid=' + custid + '&ft=' + ft;
                        console.log(info)
                         $.ajax({
                                     type: "GET",
                                     url:  "@Url.Action("UpdateStime")",
                                        data: info2,
                                     success: function (data) {
                    //      location.reload(true);
                                        $("#taskftime_" + del_id[1]).html(data);
                                                 }
                                });
                    }

                    //------------------
                    var theTotal = 0;
                    $('[id^=taskest_]').each(function () {
                        var val = $(this).text().replace(" ", "").replace(",-", "");
                        theTotal += parseInt(val);
                    });

                    console.log(theTotal);
                    $("#totalhours").html(theTotal);

            //-----------------------

                } else {
                    alert("The input value must be divisible by 0.25");
                }

            }

             if (control_name == "notetask2") {

                 var custid = $("#notetask2_" + del_id[1]).val();
                    custid = custid.replace(/<br\s*\/?>/mg, "\n");
                     $("#notetask_" + del_id[1]).html(custid);
                     $('#selnote_' + del_id[1]).hide();
                 $("#notetask_" + del_id[1]).show();

                  var info = 'id=' + del_id[1] + '&name=' + custid;
                     console.log(info);
                    var url = "@Url.Action("UpdateTimesheetNote")";

                }


                $.ajax({
                    type: "GET",
                    url: url,
                    data: info,
                    success: function () {
                        //      location.reload(true);
                    }
                });


                e.preventDefault();
                e.stopPropagation();
                return false;


            });
         $(document).on('focus', ".datepicker5", function () {
            $(this).datepicker();
        });
        $(document).on('focus', ".timepicker89", function () {
            $(this).timepicker();
        });


        $('body').on("change", '.timepicker89', function () {

              var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            console.log(id_string);
            var control_name = del_id[0];

            var custid = $(this).val();

            $("#taskstime_" + del_id[1]).html(custid);
            $('#selstime_' + del_id[1]).hide();
            $("#taskstime_" + del_id[1]).show();

            var ft = $("#taskest_" + del_id[1]).text();

            var info = 'id=' + del_id[1] + '&pid=' + custid + '&ft=' + ft;
            console.log(info)

             var url = "@Url.Action("UpdateStime")";


            $.ajax({
                type: "GET",
                url: url,
                data: info,
                success: function (data) {
                    //      location.reload(true);
                    $("#taskftime_" + del_id[1]).html(data);
                }
            });

        });





     $('body').on("change", ".datepicker5", function () {

              var prev = $(this).data('val');

           //   alert($(this).val());

            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            console.log(id_string);
            var control_name = del_id[0];

            var custid = $(this).val();


              var info = 'id=' + del_id[1] + '&pid=' + custid;

           //   $("#taskstart_" + del_id[1]).html(custid);
            console.log(info);

              var std = $('#startweekday').text();
              console.log("std:" + std);
                $.ajax({
                type: "GET",
                    url: "@Url.Action("CheckDate")",
                //  data: "refdate=" + custid,
                    data: "refdate=" + custid+ "&based="+std,
                    success: function (data) {
                        console.log("data:" + data);

                        //anything goes update date
                         var url = "@Url.Action("UpdateTimesheetEdate")";
                        if (data === "true") {

                                    $.ajax({
                                        type: "GET",
                                        url: url,
                                        data: info,
                                        success: function () {
                                            //      location.reload(true);
                                            $("#taskstart_" + del_id[1]).text(custid);

                                            console.log("DAte:" + custid);
                                        }
                            });

                        } else {

                            if (confirm("You are moving this record to another week. Are you sure? Yes / No")) {

                                    $.ajax({
                                        type: "GET",
                                        url: url,
                                        data: info,
                                        success: function (data2) {
                                            console.log("data2:" + data2);
                                            //      location.reload(true);
                                            $("#taskstart_" + del_id[1]).text(custid);
                                            $("#row_" + del_id[1]).fadeOut("slow", function () {
                                                // After animation completed:
                                                $("#row_" + del_id[1]).remove();
                                                $("#secondrow_" + del_id[1]).remove();
                                                 window.location.href = "@Url.Action("TimeSheet")?ed=" + custid;
                                            });
                                        }
                                });


                            } else {
                           $("#taskstart_" + del_id[1]).text($.session.get("prevdate"));
                                //---------- set date
                             //   $('#starttask_' + del_id[1]).datepicker()

                                $('#starttask_' + del_id[1]).datepicker({ dateFormat: 'mm/dd/yy' }).datepicker('setDate', $.session.get("prevdate"));

                              //  $('#datepicker').datepicker({ dateFormat: 'yy-mm-dd' }).datepicker('setDate', '2010-07-25');
                            }


                        }
                }
            });



              $('#selstart' + del_id[1]).hide();
              $("#taskstart_" + del_id[1]).show();



        });


        function bugsolve() {

         //   alert('fire');

            $('[id^=selcust_]').each(function () {
                $(this).hide();
            });

            $('[id^=selpr_]').each(function () {
                $(this).hide();
            });

            $('[id^=seldesc_]').each(function () {
                $(this).hide();
            });

            $('[id^=seldev_]').each(function () {
                $(this).hide();
            });

            $('[id^=selresc_]').each(function () {
                $(this).hide();
            });

            $('[id^=selstat_]').each(function () {
                $(this).hide();
            });


            $('[id^=selproj_]').each(function () {
                $(this).hide();
            });

            $('[id^=selest_]').each(function () {
                $(this).hide();
            });

            $('[id^=custtask_]').each(function () {
                $(this).show();
            });
            $('[id^=taskpr_]').each(function () {
                $(this).show();
            });

            $('[id^=taskproj_]').each(function () {
                $(this).show();
            });

            $('[id^=descriptiontask1_]').each(function () {
                $(this).show();
            });

            $('[id^=descriptiontask1_]').each(function () {
                $(this).show();
            });

            $('[id^=taskdev_]').each(function () {
                $(this).show();
            });

            $('[id^=taskresc_]').each(function () {
                $(this).show();
            });

            $('[id^=taskstat_]').each(function () {
                $(this).show();
            });

            $('[id^=taskest_]').each(function () {
                $(this).show();
            });

        }

        function checktdnote() {


            $('[id^=tdcust_]').each(function () {
               // $(this).show();
                if ($(this).hasClass("tdnote")) {

                }else {
                    $(this).addClass('tdnote');
                }
            });

            $('[id^=tdproj_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdnote")) {

                } else {
                    $(this).addClass('tdnote');
                }
            });

            $('[id^=tdtask_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdnote")) {

                } else {
                    $(this).addClass('tdnote');
                }
            });

            $('[id^=tdstart_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdnote")) {

                } else {
                    $(this).addClass('tdnote');
                }
            });

            $('[id^=tdest_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdnote")) {

                } else {
                    $(this).addClass('tdnote');
                }
            });

            $('[id^=tdstime_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdnote")) {

                } else {
                    $(this).addClass('tdnote');
                }
            });

        }


        $('body').on('change', '.savetask2', function (e) {
                checktdnote();

                var element = $(this);
                var id_string = element.attr("id");
                var del_id = id_string.split("_");
                console.log(id_string);
            var control_name = del_id[0];


                  if (control_name == "m2stat") {

                $('#selstatus_' + del_id[1]).hide();

                    var newval = $("#m2stat_" + del_id[1] + " option:selected").text();
                    var custid = $("#m2stat_" + del_id[1] + " option:selected").val();

                $('#taskstatus_' + del_id[1]).show();

                var info = 'id=' + del_id[1] + '&pid=' + custid;
                var url = "@Url.Action("UpdateTimeStatus")";   // timesheet
                $('#taskstatus_' + del_id[1]).text(newval);
                $("#m2stat_" + del_id[1]).val("");


                $('#taskstatus_' + del_id[1]).show();
                $("#selstatus_" + del_id[1]).remove();
                $(this).remove();



            }





                if (control_name == "selectcust") {
                    $('#selcust_' + del_id[1]).hide();
                    var newval = $("#selectcust_" + del_id[1] + " option:selected").text();
                    var custid = $("#selectcust_" + del_id[1] + " option:selected").val();
                    $("#selectcust_" + del_id[1]).val("");
                    var info = 'id=' + del_id[1] + '&custid=' + custid;
                    $('#custtask_' + del_id[1]).text(newval);
                    var url = "@Url.Action("UpdateTimeCust")";   // timesheet

                    $('#custtask_' + del_id[1]).show();
                    $("#selcust_" + del_id[1]).remove();
                    $(this).remove();

                    var taskproj = $('#taskproj_' + del_id[1]).text();

                //    alert('fire');
                    $('#taskproj_' + del_id[1]).text('Select Project');

                    $("#custid_" + del_id[1]).val(custid); // cust id for project and task verification



                }

                if (control_name == "selectproj") {


                    var newval = $("#selectproj_" + del_id[1] + " option:selected").text();
                    var custid = $("#selectproj_" + del_id[1] + " option:selected").val();
                    var info = 'id=' + del_id[1] + '&pid=' + custid;
                    $('#taskproj_' + del_id[1]).text(newval);
                    var url = "@Url.Action("UpdateTimeProj")";
                    $('#selproj_' + del_id[1]).hide();
                    $('#taskproj_' + del_id[1]).show();
                    $('#selproj_' + del_id[1]).val("");

                    $('#projid_' + del_id[1]).val(custid);

                    $('#descriptiontask1_' + del_id[1]).text("Select task");

                    $('td span#selproj_' + del_id[1]).remove();

            }

            if (control_name == "selecttask") {

                var newval = $("#selecttask_" + del_id[1] + " option:selected").text();
                var custid = $("#selecttask_" + del_id[1] + " option:selected").val();
                    var info = 'id=' + del_id[1] + '&pid=' + custid;
                     $('#descriptiontask1_' + del_id[1]).text(newval);
                    var url = "@Url.Action("UpdateTimeTask")";
                    $('#seldesc_' + del_id[1]).hide();
                $('#descriptiontask1_' + del_id[1]).show();
                    $('#seldesc_' + del_id[1]).val("");

                $('#taskid_' + del_id[1]).val(newval);
                $('#seldesc_' + del_id[1]).remove();

                //------ get subtask value -----------------

                var url2 = "@Url.Action("GetSubtask")";
                var info2 = 'id=' +  custid;

                console.log("url2:" + url2);
                console.log("info2:" + info2);

                $('#add_subtask_' + del_id[1] + '_p').prop('id', 'add_subtask_' + del_id[1] + '_' + custid);
                $('#save_subtask_' + del_id[1] + '_p').prop('id', 'save_subtask_' + del_id[1] + '_' + custid);
                $('#allsubtask_p').prop('id', 'allsubtask_' + custid);


                $.ajax({
                    type: "GET",
                    url: url2,
                    data: info2,
                    success: function (data) {
                        //      location.reload(true);
                        console.log("data2:" + data);
                        $('pre#notetask3_' + del_id[1]).html(data);


                    }
                });



            }


                 if (control_name == "selectresc") {
                    var newval = $("#selectresc_" + del_id[1] + " option:selected").text();
                    var custid = $("#selectresc_" + del_id[1] + " option:selected").val();
                     var info = 'id=' + del_id[1] + '&pid=' + custid;
                //     alert(info);
                    console.log(info);
                     $('#taskresc_' + del_id[1]).text(newval);
                     $('#selresc_' + del_id[1]).hide();
                     $('#taskresc_' + del_id[1]).show();
                     $('#selectlresc_' + del_id[1]).val("");
                    var url = "@Url.Action("UpdateTaskResc")";

                }
                // staff
                 if (control_name == "selectstaff") {
                    var newval = $("#selectstaff_" + del_id[1] + " option:selected").text();
                    var custid = $("#selectstaff_" + del_id[1] + " option:selected").val();
                     var info = 'id=' + del_id[1] + '&pid=' + custid;
                //     alert(info);
                    console.log(info);
                    $('#taskstaff_' + del_id[1]).text(newval);
                    var url = "@Url.Action("UpdateTaskStaff")";
                    $('#selstaff_' + del_id[1]).hide();
                    $('#selectstaff_' + del_id[1]).val("");
                }
                //pr
                  if (control_name == "selectpr") {
                    var newval = $("#selectpr_" + del_id[1] + " option:selected").text();
                    var custid = $("#selectpr_" + del_id[1] + " option:selected").val();
                     var info = 'id=' + del_id[1] + '&pid=' + custid;
                //     alert(info);
                      console.log(info);
                      $('#taskpr_' + del_id[1]).show();
                      $('#taskpr_' + del_id[1]).text(newval);
                      $('#taskpr_' + del_id[1]).text(newval);
                    var url = "@Url.Action("UpdatePr")";
                    $('#selpr_' + del_id[1]).hide();
                    $('#selectpr_' + del_id[1]).val("");
                }

                //status
                if (control_name == "selectstat") {
                    var newval = $("#selectstat_" + del_id[1] + " option:selected").text();
                    var custid = $("#selectstat_" + del_id[1] + " option:selected").val();

                    var info = 'id=' + del_id[1] + '&pid=' + custid;
                    $('#taskstat_' + del_id[1]).text(newval);
                    $('#taskstat_' + del_id[1]).show();
                    $('#selstat_' + del_id[1]).hide();
                      var url = "@Url.Action("UpdateTaskStat")";
                }
                // dev
                  if (control_name == "selectdev") {
                    var newval = $("#selectdev_" + del_id[1] + " option:selected").text();
                    var custid = $("#selectdev_" + del_id[1] + " option:selected").val();
                      $('#taskdev_' + del_id[1]).text(newval);
                      $('#taskdev_' + del_id[1]).show();
                      $('#seldev_' + del_id[1]).hide();
                      var info = 'id=' + del_id[1] + '&name=' + custid;
                      var url = "@Url.Action("UpdateTaskDev")";

                }




                console.log("url:" + url);

                $.ajax({
                    type: "GET",
                    url: url,
                    data: info,
                    success: function () {
                        //      location.reload(true);
                    }
                });



                e.preventDefault();
                e.stopPropagation();
                return false;


            });
    </script>


    <script>
         //-------------------------  Staff Section editing and adding -------------------------------------
        //Editing section
        function checktdstaff() {


            $('[id^=tdfirst_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdstaff")) {

                } else {
                    $(this).addClass('tdstaff');
                }
            });

            $('[id^=tdlast_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdstaff")) {

                } else {
                    $(this).addClass('tdstaff');
                }
            });

            $('[id^=tdalias_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdstaff")) {

                } else {
                    $(this).addClass('tdstaff');
                }
            });

            $('[id^=tdusername_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdstaff")) {

                } else {
                    $(this).addClass('tdstaff');
                }
            });

            $('[id^=tdpassword_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdstaff")) {

                } else {
                    $(this).addClass('tdstaff');
                }
            });

            $('[id^=tdtype_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdstaff")) {

                } else {
                    $(this).addClass('tdstaff');
                }
            });

            $('[id^=tdtypep_]').each(function () {
                // $(this).show();
                if ($(this).hasClass("tdstaff")) {

                } else {
                    $(this).addClass('tdstaff');
                }
            });

        }

        //Editing section

        function bugstaff() {

            //   alert('fire');

            $('[id^=sfirst2_]').each(function () {
                $(this).hide();
            });

            $('[id^=sfirst_]').each(function () {
                $(this).show();
            });

            $('[id^=slast2_]').each(function () {
                $(this).hide();
            });
            $('[id^=slast_]').each(function () {
                $(this).show();
            });

            $('[id^=salias2_]').each(function () {
                $(this).hide();
            });

            $('[id^=salias_]').each(function () {
                $(this).show();
            });

            $('[id^=susername2_]').each(function () {
                $(this).hide();
            });

            $('[id^=susername_]').each(function () {
                $(this).show();
            });

            $('[id^=spassword2_]').each(function () {
                $(this).hide();
            });

            $('[id^=spassword_]').each(function () {
                $(this).show();
            });

            $('[id^=stype2_]').each(function () {
                $(this).hide();
            });
            $('[id^=stype_]').each(function () {
                $(this).show();
            });

            $('[id^=stypep2_]').each(function () {
                $(this).hide();
            });
            $('[id^=stypep_]').each(function () {
                $(this).show();
            });




        }

        $("body").on('blur', '.sIn', function (e) {


            checktdstaff();

                var element = $(this);
                var id_string = element.attr("id");
                var del_id = id_string.split("_");

                var control_name = del_id[0];
                console.log(id_string);




             if (control_name == "ifirst") {

                 var custid = $("#ifirst_" + del_id[1]).val();
                 //   custid = custid.replace(/<br\s*\/?>/mg, "\n");
                     $("#sfirst_" + del_id[1]).html(custid);
                     $('#sfirst2_' + del_id[1]).hide();
                 $("#sfirst_" + del_id[1]).show();


                 if ((del_id[1]) === '0') {
                       $.ajax({
                        type: "GET",
                       url: "@Url.Action("GetStaffScope")",
                        data: "id=" + custid,
                        dataType: "text",
                        success: function (data) {


                            $('tr#row_0').prop('id', 'row_' + data);
                            $('a#toogle_0').prop('id', 'toogle_' + data);
                            $('a#sremove_0').prop('id', 'remove_' + data);
                            $('i#drop_0').prop('id', 'drop_' + data);



                            $('#tdfirst_0').prop('id', 'tdfirst_' + data);
                            $('#sfirst_0').prop('id', 'sfirst_' + data);
                            $('#sfirst2_0').prop('id', 'sfirst2_' + data);
                            $('#ifirst_0').prop('id', 'ifirst_' + data);

                            $('#tdlast_0').prop('id', 'tdlast_' + data);
                            $('#slast_0').prop('id', 'slast_' + data);
                            $('#slast2_0').prop('id', 'slast2_' + data);
                            $('#ilast_0').prop('id', 'ilast_' + data);

                            $('#tdalias_0').prop('id', 'tdalias_' + data);
                            $('#salias_0').prop('id', 'salias_' + data);
                            $('#salias2_0').prop('id', 'salias2_' + data);
                            $('#ialias_0').prop('id', 'ialias_' + data);

                            $('#tdusername_0').prop('id', 'tdusername_' + data);
                            $('#susername_0').prop('id', 'susername_' + data);
                            $('#susername2_0').prop('id', 'susername2_' + data);
                            $('#iusername_0').prop('id', 'iusername_' + data);

                            $('#tdpassword_0').prop('id', 'tdpassword_' + data);
                            $('#spassword_0').prop('id', 'spassword_' + data);
                            $('#spassword2_0').prop('id', 'spassword2_' + data);
                            $('#ipassword_0').prop('id', 'ipassword_' + data);


                            $('#tdtype_0').prop('id', 'tdtype_' + data);
                            $('#stype_0').prop('id', 'stype_' + data);

                            $('#tdtypep_0').prop('id', 'tdtypep_' + data);
                            $('#stypep_0').prop('id', 'stypep_' + data);





                                },
                                error: function (xhr) {
                                    alert('error');
                                }
                            });
                 }
                 else {
                        var info = 'id=' + del_id[1] + '&pid=' + custid;
                     console.log(info);
                    var url = "@Url.Action("stEditFullname")";
                 }


              }

               if (control_name == "ilast") {

                 var custid = $("#ilast_" + del_id[1]).val();
                 //   custid = custid.replace(/<br\s*\/?>/mg, "\n");
                     $("#slast_" + del_id[1]).html(custid);
                     $('#slast2_' + del_id[1]).hide();
                 $("#slast_" + del_id[1]).show();

                 var info = 'id=' + del_id[1] + '&pid=' + custid;
                     console.log(info);
                    var url = "@Url.Action("stEditLastname")";
              }

                if (control_name == "ialias") {

                 var custid = $("#ialias_" + del_id[1]).val();
                 //   custid = custid.replace(/<br\s*\/?>/mg, "\n");
                     $("#salias_" + del_id[1]).html(custid);
                     $('#salias2_' + del_id[1]).hide();
                 $("#salias_" + del_id[1]).show();

                 var info = 'id=' + del_id[1] + '&pid=' + custid;
                     console.log(info);
                    var url = "@Url.Action("stEditCode")";
              }

                if (control_name == "iusername") {

                 var custid = $("#iusername_" + del_id[1]).val();
                 //   custid = custid.replace(/<br\s*\/?>/mg, "\n");
                     $("#susername_" + del_id[1]).html(custid);
                     $('#susername2_' + del_id[1]).hide();
                 $("#susername_" + del_id[1]).show();

                 var info = 'id=' + del_id[1] + '&pid=' + custid;
                     console.log(info);
                    var url = "@Url.Action("stEditUsername")";
              }

                if (control_name == "ipassword") {

                    var custid = $("#ipassword_" + del_id[1]).val();
                 //   custid = custid.replace(/<br\s*\/?>/mg, "\n");
                    $("#spassword_" + del_id[1]).html(custid);
                    $('#spassword2_' + del_id[1]).hide();
                    $("#spassword_" + del_id[1]).show();

                 var info = 'id=' + del_id[1] + '&pid=' + custid;
                     console.log(info);
                    var url = "@Url.Action("stEditPassword")";
                }

              if ((del_id[1]) !== '0') {
                  $.ajax({
                      type: "GET",
                      url: url,
                      data: info,
                      success: function () {
                          //      location.reload(true);
                      }
                  });
              }


                e.preventDefault();
                e.stopPropagation();
                return false;


            });






        // new row record addfields 4
        $('body').on('click', '.add_fields4', function () {

            var dy4 = '';
            dy4 = dy4 + '<tr class="record" id="row_0">';
            dy4 = dy4 + '<td style="background-color: white;border-top-color: white;border-bottom-color: white;border-left-color: white;"> <a href="#" id="toogle_0" class="dplay" style="margin-top:25px;"><i id="drop_0" class="fas fa-play"></i></a> <a href="#" id="d_0" style="display:none" class="down_arrow"><i class="fas fa-sort-down fa-2x" style="color:#5fac11;"></i></a> </td>';
            dy4 = dy4 + '<td style="border: 1px solid #dee2e6;" id="tdfirst_0" class="tdstaff"> <span id="sfirst_0" ></span> <span id="sfirst2_0" class="sel_cust" style="display: none;"> <input id="ifirst_0" class="form-control sIn" type="text" /> </span> </td>';
            dy4 = dy4 + '<td id="tdlast_0" class="tdstaff"> <span id="slast_0" ></span> <span id="slast2_0" class="sel_cust" style="display: none;"> <input id="ilast_0" class="form-control sIn" type="text" /> </span> </td>';
            dy4 = dy4 + '<td id="tdalias_0" class="tdstaff"> <span id="salias_0" ></span> <span id="salias2_0" class="sel_cust" style="display: none;"> <input id="ialias_0" class="form-control sIn" type="text" maxlength="3" /> </span> </td>';
            dy4 = dy4 + '<td id="tdtype_0" class="tdstaff" > <span id="stype_0" ></span> </td >';
            dy4 = dy4 + '<td id="tdusername_0" class="tdstaff"> <span id="susername_0" ></span> <span id="susername2_0" class="sel_cust" style="display: none;"> <input id="iusername_0" class="form-control sIn" type="text" /> </span> </td>';
            dy4 = dy4 + '<td id="tdpassword_0" class="tdstaff"> <span id="spassword_0" ></span> <span id="spassword2_0" class="sel_cust" style="display: none;"> <input id="ipassword_0" class="form-control sIn" type="text" /> </span> </td>';
            dy4 = dy4 + '<td id = "tdtypep_0" class="tdstaff"> <span id="stypep_0" ></span> </td>';
            dy4 = dy4 + '<td id = "tdtimezone_0" class="tdstaff"> <span id="spassword_0" ></span> </td>';
            dy4 = dy4 + '<td><a href="#" id="sremove_0" class="sremove_field2" ><i class="fas fa-minus-circle"></i></a></td></tr > ';
            dy4 = dy4 + '<tr style="background-color:#dee2e6" id="secondrow_0" class="notShow hideall">';
            dy4 = dy4 + '<td style="background-color: white;border-top-color: white;border-bottom-color: white;border-left-color: white;"> </td>';
            dy4 = dy4 + '< td colspan = "8" > <div class="row3"> </div> <!--end of row 3-- > </td></tr > ';


            if ($('#row_0').length)         // use this if you are using id to check
            {
                //  alert("The newly added row is not yet save. Please select customers to save it.")
                if (confirm("Do you want to quit the current record? Information will be lost. Yes / No")) {
                    $("#row_0").fadeOut("slow", function () {
                        // After animation completed:
                        $("#row_0").remove();
                        $("#secondrow_0").remove();
                    });
                }
            }
            else {

                $('#stafftable tbody').prepend(dy4);

                bugstaff();
                $('.hideall').hide();
                $('.down_arrow').hide();

                $('[id^=secondrow_]').each(function () {
                    $(this).hide();
                });

                $('[id^=toogle_]').each(function () {
                    $(this).show();
                });
                $('#toogle_0').show();

            }
        });


        $("body").on('click', '.tdstaff', function () {

            bugstaff();
            checktdstaff();

            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");

            var control_name = del_id[0];
            console.log(id_string);

         //   bugsolve();
            $('.hideall').hide();


            //------
            $('.sel_cust').hide();
            $('.sel_cus').hide();
            $('.sel_stat').hide();
            $('.tdstaff').show();
            //------

            console.log(control_name);
            $('#secondrow_' + del_id[1]).show();


            $('[id^=d_]').each(function () {
                $(this).hide();
            });


            $('[id^=toogle_]').each(function () {

                $(this).show();
            });



            $('#d_' + del_id[1]).show();

            if (control_name == "tdusername") {
                $('#susername2_' + del_id[1]).show();                // show control
                $('#susername_' + del_id[1]).hide();
            }

            if (control_name == "tdpassword") {
                $('#spassword2_' + del_id[1]).show();                // show control
                $('#spassword_' + del_id[1]).hide();
            }

            if (control_name == "tdlast") {
                $('#slast2_' + del_id[1]).show();                // show control
                $('#slast_' + del_id[1]).hide();
            }

            if (control_name == "tdfirst") {
                $('#sfirst2_' + del_id[1]).show();                // show control
                $('#sfirst_' + del_id[1]).hide();

              //  alert(control_name);
            }

            if (control_name == "tdalias") {
                $('#salias2_' + del_id[1]).show();                // show control
                $('#salias_' + del_id[1]).hide();
            }

              if (control_name == "tdtype") {
                //------------------- get data from  sql server ----

                  var tmp90 = $('#stype_' + del_id[1]).text();
                  $('#tdtype_' + del_id[1]).removeClass('tdstaff');
                console.log(control_name);
                $('#stype2_' + del_id[1]).remove();
             //   alert(tmp);
                console.log("tmp:" + tmp90);

                          $.ajax({
                        type: "GET",
                         url: "@Url.Action("GetSType")",
                              dataType: "text",
                              success: function (data) {
                                  console.log("data:" + data);

                            var numbers =data.split('^');
                                //  var op = '<option value="0">Select Customer</option>';
                                //  var op = '<option value="">' + tmp + '</option>';

                                  if (tmp90 === '') {
                                      tmp90 = "Select";
                                  }

                                  var op2 = '<option value="" disabled selected style="display:none;">' + tmp90 +'</option>';
                                  var op1 = '';
                                  var op = '';
                            for (var i = 0; i < numbers.length-1; i++) {
                             var d2 = numbers[i].split(':')

                                if (tmp90.trim() !== d2[1]) {
                                    op = op + '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                    console.log(op);
                                }
                                else {
                                    op1 = '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                    console.log(op1);
                                }

                                  }

                                  var me = '';
                                  me = '<span id="stype2_' + del_id[1] + '">';
                                  me = me + '<select class="form-control savetask22" id="selecttype_' + del_id[1] + '">';
                                  me = me + op2 + op1 + op;
                                 // me = me + op1 + op;
                                  me = me + '</select></span>';


                                  $('#stype_' + del_id[1]).hide();
                                  $(me).insertAfter('#stype_' + del_id[1]);
                                  //  $('#selectcust_' + del_id[1]).prepend(op2);

                                  $('#selecttype_' + del_id[1]).val('');
                                 // element.find('span').text('');



                },
                error: function (xhr) {
                    alert('error customer');
                }
            });


            }
          if (control_name == "tdtypep") {
                //------------------- get data from  sql server ----
              var tmp2 = $('#stypep_' + del_id[1]).text();
              $('#tdtypep_' + del_id[1]).removeClass('tdstaff');
                console.log(control_name);
                $('#stypep2_' + del_id[1]).remove();
             //   alert(tmp);
                console.log(tmp2);

                          $.ajax({
                        type: "GET",
                         url: "@Url.Action("GetSPriv")",
                              dataType: "text",
                              success: function (data) {

                            var numbers =data.split('^');
                                //  var op = '<option value="0">Select Customer</option>';
                                //  var op = '<option value="">' + tmp + '</option>';


                                  var op2 = '<option value="" disabled selected style="display:none;">' + tmp2 +'</option>';
                                  var op1 = '';
                                  var op = '';
                            for (var i = 0; i < numbers.length-1; i++) {
                             var d2 = numbers[i].split(':')

                                if (tmp2.trim() !== d2[1]) {
                                    op = op + '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }
                                else {
                                    op1 = '<option value=' + d2[0] + '>' + d2[1] + '</option>';
                                }

                                  }

                                  var me = '';
                                  me = '<span id="stypep2_' + del_id[1] + '" class="sel_cust">';
                                  me = me + '<select class="form-control savetask22" id="selecttypep_' + del_id[1] + '">';
                                  me = me + op2 + op1 + op;
                                  me = me + '</select></span>';


                                  $('#stypep_' + del_id[1]).hide();
                                  $(me).insertAfter('#stypep_' + del_id[1]);

                                 $('selecttypep_' + del_id[1]).val('');


                },
                error: function (xhr) {
                    alert('error customer');
                }
            });


            }
        });


        //---------------------- add new row -------------------------------------------------
        $(document).ready(function () {
            var SelectedDates = {};

             @if ( ViewData["dataDates"] != null)
             {
                 foreach (var item79 in ViewData["dataDates"] as IList<TaskManModule>)
                 {

                    @:  SelectedDates[new Date('@item79.ddate')] = new Date('@item79.ddate');
                }
             }


         //   SelectedDates[new Date('04/05/2012')] = new Date('04/05/2012');
         //   SelectedDates[new Date('05/04/2012')] = new Date('05/04/2012');


            $('.datepicker79').datepicker({
                beforeShowDay: function (date) {
                    var Highlight = SelectedDates[date];
                    if (Highlight) {
                        return [true, "high", Highlight];
                    }

                }
            });
            $('.datepicker99').datepicker({
                beforeShowDay: function (date) {
                    var Highlight = SelectedDates[date];
                    if (Highlight) {
                        return [true, "high", Highlight];
                    }

                }
            });



            $('.datepicker-timesheet-previous').datepicker({
                beforeShowDay: function (date) {
                    var Highlight = SelectedDates[date];
                    if (Highlight) {
                        return [true, "high", Highlight];
                    }

                }
            });
            $('.datepicker-timesheet-next').datepicker({
                beforeShowDay: function (date) {
                    var Highlight = SelectedDates[date];
                    if (Highlight) {
                        return [true, "high", Highlight];
                    }

                }
            });



        });


         $('body').on('change', '.savetask22', function (e) {
             checktdstaff();

                var element = $(this);
                var id_string = element.attr("id");
                var del_id = id_string.split("_");
                console.log(id_string);
             var control_name = del_id[0];

             if (control_name == "selecttype") {
                   // $('#selcust_' + del_id[1]).hide();
                    var newval = $("#selecttype_" + del_id[1] + " option:selected").text();
                    var custid = $("#selecttype_" + del_id[1] + " option:selected").val();
                    $("#selecttype_" + del_id[1]).val("");
                    var info = 'id=' + del_id[1] + '&custid=' + newval;
                    $('#stype_' + del_id[1]).text(newval);
                    var url = "@Url.Action("UpdateStaffType")";   // timesheet

                    $('#stype_' + del_id[1]).show();
                    $("#stype2_" + del_id[1]).remove();
                 $(this).remove();
                 $('#tdtype_' + del_id[1]).addClass('tdstaff');
            }
             if (control_name == "selecttypep") {
                   // $('#selcust_' + del_id[1]).hide();
                    var newval = $("#selecttypep_" + del_id[1] + " option:selected").text();
                    var custid = $("#selecttypep_" + del_id[1] + " option:selected").val();
                    $("#selecttype_" + del_id[1]).val("");
                    var info = 'id=' + del_id[1] + '&custid=' + newval;
                    $('#stypep_' + del_id[1]).text(newval);
                    var url = "@Url.Action("UpdateAdminPriv")";   // timesheet

                    $('#stypep_' + del_id[1]).show();
                    $("#stypep2_" + del_id[1]).remove();
                 $(this).remove();
                 $('#tdtypep_' + del_id[1]).addClass('tdstaff');
             }

             console.log("url:" + url);

             $.ajax({
                 type: "GET",
                 url: url,
                 data: info,
                 success: function () {
                     //      location.reload(true);
                 }
             });




            e.preventDefault();
            e.stopPropagation();
            return false;

         });

         $('body').on("click", ".sremove_field2", function (e) {
            e.preventDefault();

            //------
            $('.sel_cust').hide();
            $('.sel_cus').hide();
            $('.sel_stat').hide();
            $('.task_input2').show();
            //------

            var element = $(this);

            var id_string = element.attr("id");

            var del_id = id_string.split("_");
            var info = 'id=' + del_id[1];


            let tr = $('#row_' + del_id[1]);
            console.log(info);

            if (confirm("Are you sure? This cannot be undone Yes / No")) {
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("DeleteStaff")",
                    data: info,
                    success: function () {
                    }
                });
                $("#row_" + del_id[1]).fadeOut("slow", function () {
                    // After animation completed:
                    $("#row_" + del_id[1]).remove();
                    $("#secondrow_" + del_id[1]).remove();
                });
            }

        });


        $(document).ready(function () {
            var theTotal = 0;
            $('[id^=taskest_]').each(function () {
                var val = $(this).text().replace(" ", "").replace(",-", "");
                theTotal += parseInt(val);
            });
            $("#totalhours").html(theTotal);
        });



        function getUnique(array) {

            var uniqueArray = [];



            // Loop through array values

            for (i = 0; i < array.length; i++) {

                if (uniqueArray.indexOf(array[i]) === -1) {

                    uniqueArray.push(array[i]);

                }

            }

            return uniqueArray;

        }


        $('a[href$="#Modal"]').on("click", function () {
         //   $('#modebody').text("");
       //     $("#modalCon").load("TaskPartial");
            $('#Modal').modal('show');
        });


    </script>



    <script>

        $('body').on('click', '.rtc5', function () {
            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");

            var info = 'id=' + del_id[1];




            $.confirm({
                title: 'Hey!',
                content: 'Are you sure you have entered all your hours for this task?',
                icon: 'fa fa-question-circle',
                animation: 'scale',
                closeAnimation: 'scale',
                opacity: 0.5,
                buttons: {
                    'confirm': {
                        text: 'Proceed',
                        btnClass: 'btn-blue',
                        action: function () {
                              $.ajax({
                                    type: "GET",
                                    url: "@Url.Action("UpdateRTC")",
                                    data: info,
                                    success: function () {

                                    }
                                });

                                $('#row_' + del_id[1]).remove();
                        }
                    },
                    cancel: function () {
                        //  $.alert('you clicked on <strong>cancel</strong>');
                    },

                }
            });




            @*if (confirm("Are you sure you have entered all your hours for this task?")) {
                 $.ajax({
                    type: "GET",
                    url: "@Url.Action("UpdateRTC")",
                    data: info,
                    success: function () {

                    }
                });

                $('#row_' + del_id[1]).remove();
            }*@



            var control_name = del_id[0];

            e.preventDefault();
            e.stopPropagation();
            return false;

        });





        $('body').on('click', '.add_fields5', function () {

            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");

            var control_name = del_id[0];

           // alert(del_id[1]);

            // get all data

            var custtask = $('#custtask2_' + del_id[1]).text();
            var custid = $('#custid2_' + del_id[1]).val();
            var taskproj = $('#taskproj2_' + del_id[1]).text();
            var projid = $('#projid_' + del_id[1]).val();

            var descriptiontask1 = $('#descriptiontask1_' + del_id[1]).text();
            var taskid = $('#taskid_' + del_id[1]).val();

            // get id
            let d="";

            $.ajax({
                type: "GET",
                url: "@Url.Action("GetTimesheetScope2")",
                data: "custid=" + custid +"&projectid=" + projid +"&taskid=" + taskid,
                dataType: "text",
                success: function (data) {
                   // alert(data);  data is success

                    var newstr = "_" + data;
                    d = data;
                    // now replace dy5 _0 to newstr


       var dy5 = '<tr class="record" id="row_0" class="rowtoClick"> <td style="background-color: white;border-top-color: white;border-bottom-color: white;border-left-color: white;">';
        dy5 = dy5 + '<a href="#" id="toogle_0" class="dplay" style="margin-top:25px;"><i class="fas fa-play"></i></a>';

        dy5 = dy5 +'<a href="#" id="d_0"  class="down_arrow"><i class="fas fa-sort-down fa-2x" style="color:#5fac11;"></i></a>';
        dy5 = dy5+'</td>';
        dy5 = dy5 +'<td style="border: 1px solid #dee2e6;" id="tdcust_0" class="tdnote"> <span id="custtask_0" class="task_input2">Click to select</span> <input type="hidden" id="custid_0"  />';
        dy5 = dy5 + '<td id="tdproj_0" class="tdnote"><span id="taskproj_0" class="task_input2"></span> <input type="hidden" id="projid_0" /> </td>';
        dy5 = dy5 + '<td id="tdtask_0" class="tdnote"> <span id="descriptiontask1_0" class="task_input2"></span><input type="hidden" id="taskid_0" /></td >';
        dy5 = dy5 + '<td id="tdnote_0" class="tdnote"><span id="notetask_0" class="task_input2">Add comment</span> <span id="selnote_0" class="sel_cust" style="display: none;"> <textarea id="notetask2_0" class="autoExpand form-control task_input" rows="1" data-min-rows="1" placeholder="description" name="description" maxlength="250">Add comment</textarea> </span></td>';
        dy5 = dy5 + '<td id="tdstart_0" class="tdnote"><span id="taskstart_0" class="task_input2">@ViewData["SystemDate"]</span> <span id="selstart_0" class="sel_stat" style="display: none;"> <input class="datepicker5" id="starttask_0" type="text" value="@ViewData["SystemDate"]" /> </span> </td >';
        dy5 = dy5 + '<td id="tdest_0" class="tdnote">';
        dy5 = dy5 + '<span id="taskest_0" class="task_input2">0.00</span><span id="selest_0" class="sel_cust" style="display: none;">';
        dy5 = dy5 + '<input id="esttask_0" class="form-control task_input" type="text" value="0.00" /></span> </td>';
      //  dy5 = dy5 + ' <td id="tdrtc_0" class="tdnote"> <span id="taskrtc_0" class="task_input2"></span> <span id="selrtc_0" class="sel_cust" style="display: none;"></span> </td>';
        dy5 = dy5 + '</tr>';
        dy5 = dy5 + '<tr class="notShow hideall" id="secondrow_0" style="display:none"><td style="background-color: white;border-top-color: white;border-bottom-color: white;border-left-color: white;"><a href="#" id="remove_0" class="remove_field2" style="position:relative;top: 62px;"><i class="fas fa-minus-circle"></i></a></td>';

    //                dy5 = dy5 + '<td colspan = "6" > <div class="row3"> <div style="position:relative;height:150px;border: 1px solid #dee2e6;padding: 10px 10px 10px 10px; " class="w-29"> <div style="float:left;" class="w-100"> <div style="float:left"> Task Summary:<br /> This is a dummy text statement </div> <div style="float:right"> 04/21/2020 </div> </div> <div style="position:absolute;bottom: 5px;font-size: 9px;right: 10px;"> <a href="#"><i class="fas fa-external-link-alt fa-2x"></i></a> </div> </div> <div class="w-1"> </div>';

  //      dy5 = dy5 + '<div style="background-color:white;position:relative;height:150px;border:solid 1px; padding: 10px 10px 10px 10px; " class="w-29"> <div style="float:left;" class="w-100">';
   //     dy5 = dy5 + '<div class="td-main" style="float:left; display: block; width: 100%;"> Subtasks:<br /> <pre id="notetask3_0" class="td-label"></pre> <span id="selnote_0" class="td-control" data-type="txt" data-field="notes" style="display: none;"> <textarea id="notetask2_0" style=" display: block; width: 100%; height: 80%;" class="form-control td-txt" rows="4" data-min-rows="4" placeholder="description" name="description"></textarea> </span> </div>';
  //                  dy5 = dy5 + '<div style="float:right"></div> </div> <div style="position:absolute;bottom: 5px;font-size: 9px;right: 10px;"> <a href="#"><i class="fas fa-external-link-alt fa-2x"></i></a> </div> </div> <div class="w-29"> </div> <div class="w-1"> </div> <div class="w-10"> <button type="button" class="btn btn-success w-100 savetask23" style="margin-bottom:5px;" id="save_0">Save</button><button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Notes</button> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Files</button> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Images</button> </div> </div > </td > </tr > ';

                    dy5 = dy5 + '<td colspan = "6" > <div class="row3"> <div style="position:relative;height:150px;padding: 10px 10px 10px 10px; " class="w-29"> <div style="float:left;" class="w-100"> <div style="float:left">Requirements<br /><span id="require_0"></span></div> </div> <div style="position:absolute;bottom: 5px;font-size: 9px;right: 10px;"> <a href="#"><i class="fas fa-external-link-alt fa-2x"></i></a> </div> </div> <div class="w-1"> </div>';
                    dy5 = dy5 + '<div style="background-color:white;position:relative;min-height:150px; height: auto;border: 1px solid #dee2e6; padding: 10px 10px 10px 10px;" class="w-29 td-main"> <div style="float:left;" class="w-100"> <div style="float:left; display: block; width: 100%;"> Subtask v2: &nbsp;<a id="add_subtask_0_p" href="#" class="subtasklist"><i class="fas fa-plus-circle"></i></a>&nbsp;&nbsp; <a id="save_subtask_0_p" href="#" style="display:none" class="savetasklist"><i class="fas fa-save"></i></a> <div style="height:101px;overflow-y: auto;" id="divlist_0"> <ul class="list-group checked-list-box" id="tasklist_0"> </ul>';
                    dy5 = dy5 + '</div> <span id="selnote2_0" style="display: none;"> <textarea id="subtaskinfo_0" style=" display: block; width: 100%; height: 80%;" class="form-control " rows="4" data-min-rows="4" placeholder="description" name="description"></textarea> </span> </div> <div style="float:right"> </div> </div> <div style="float:left;" class="w-100"> <div style="position:absolute;bottom: 5px;font-size: 11px;background-color: #002080;color:white;height:20px;width:304px;display:block"> <span style="float:left;margin-left:5px;"><strong>Status: </strong></span> <span style="float:right;margin-right:5px"><a href="#" style="color:white" class="loadallsubtask" id="allsubtask_p"><i class="fas fa-external-link-alt"></i></a></span> </div> </div> </div>';
                    dy5 = dy5 + '<div class="w-29" > </div > <div class="w-1"> </div> <div class="w-10"> <button type="button" class="btn btn-success w-100 savetask24" style="margin-bottom:5px;" id="save_0">Save</button><button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Notes</button> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Files</button> <button type="button" class="btn btn-primary w-100" style="margin-bottom:5px;">Images</button> </div> </div > </td > </tr > ';

                    dy5 = dy5.replace(/_0/g, newstr);

                    var pstr = "_" +taskid;
                    dy5 = dy5.replace(/_p/g, pstr);



                    // now append
                    $('#taskmantable tbody').prepend(dy5);
                    // now add the values

                    $('#custtask_' + data).text(custtask);
                    $('#custid_' + data).val(custid);
                    $('#taskproj_' + data).text(taskproj);
                    $('#projid_' + data).val(projid);
                    $('#descriptiontask1_' + data).text(descriptiontask1);
                    $('#taskid_' + data).val(taskid);

                    // all the controls


                    bugsolve();
                    $('.hideall').hide();
                    $('.down_arrow').hide();

                    $('[id^=secondrow_]').each(function () {
                        $(this).hide();
                    });

                    $('[id^=remove_]').each(function () {
                        $(this).hide();
                    });

                    $('[id^=toogle_]').each(function () {
                        $(this).show();
                    });

                    // set focus to the add comment section

                    $('#selnote_' + data).show();                // show control
                    console.log("newstr:" + data);
                    $('#notetask_' + data).hide();

                    $('#notetask2_' + data).focus();

                    $('#secondrow_' + data).show();


                }
            });

            var url2 = "@Url.Action("GetStatus")";
            console.log("url2:" + url2);

            var dat2 = taskid;
            console.log("dat2:" + dat2);
              $.ajax({
                type: "GET",
                url: url2,
                data: "taskid=" + dat2 ,
                dataType: "text",
                  success: function (data2) {
                      console.log("d2:" + data2);
                      $('#require_' + d).text(data2);

                  }
              });





        });
    </script>

    <script>

        $(document).ready(function () {
            var SelectedDates = {};
            SelectedDates[new Date('07/07/2020')] = new Date('07/07/2020');
            SelectedDates[new Date('07/10/2020')] = new Date('07/10/2020');

            $('#select_d').datepicker({
                beforeShowDay: function (date) {
                    var Highlight = SelectedDates[date];
                    if (Highlight) {
                        return [true, "Highlighted", Highlight];
                    }
                    else {
                        return [true, '', ''];
                    }
                }
            });


        });


        $(document).ready(function () {
          //  $("#taskpart").load("TaskPartial");
         //   $("#taskpart").load('@Url.Action("TaskPartial", "Default")');
        });

        $('body').on('click','.savetask24', function (e) {



          //  alert(del_id[1]);

             //var custid = $("#notetask2_" + del_id[1]).val();
             //custid = custid.replace(/<br\s*\/?>/mg, "\n");
             //$("#notetask_" + del_id[1]).html(custid);
             //$('#selnote_' + del_id[1]).hide();
             //$("#notetask_" + del_id[1]).show();

             //var info = 'id=' + del_id[1] + '&name=' + custid;
             //console.log(info);
           // var url = "@Url.Action("UpdateTimesheetNote")";  sel_cust


            $('.task_input2').show();
            $('.sel_cust').hide();
            $('.sel_stat').hide();

            $('.hideall').hide();
            $('.dplay').show();
            $('.down_arrow').hide();



             e.preventDefault();
             e.stopPropagation();
            return false;

        });


    </script>

    <!-- new code for subtask v2-->
    <script>

        //---------------------------------------------------------------
        $('body').on('click', '.subtasklist', function (e) {
            var element = $(this);

            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            var xid = del_id[2];
            var xid2 = del_id[3];
            var info = 'id=' + xid;
            $(this).hide();
            $('#divlist_' + xid).hide();
            $('#save_subtask_' + xid + '_' + xid2 ).show();

            $('#selnote2_' + xid).show();


            console.log(del_id[1]);
            e.preventDefault();
            e.stopPropagation();
            return false;

        });

        $('body').on('click', '.savetasklist', function (e) {
            var element = $(this);

            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            var xid = del_id[2];
            var xid2 = del_id[3];
            var info = 'id=' + xid;

            //---- add to list  --
            console.log(xid);
            var newitem = $('#subtaskinfo_' + xid).val();
            console.log(newitem);
            $('#tasklist_' + xid).append('<li class="list-group-item" style="cursor: pointer;"><span class="state-icon glyphicon glyphicon-unchecked"></span><input type="checkbox" class="hidden" style="margin-left:-20px;margin-right:10px;">' + newitem + '</li>');

            //   ---- end add to list  --
            //   ---- add to db ---
            var url = '@Url.Action("AddSubTaskItem")';
            console.log(url);
            var info = 'plannerId=' + xid2 + '&item=' + newitem;
            $.ajax({
                type: "GET",
                url: url,
                data: info,
                success: function (data) {

                }
            });

            //---- end add to db ---
            $(this).hide();
            $('#add_subtask_' + xid + '_' + xid2 ).show();
            $('#divlist_' + xid).show();
            $('#selnote2_' + xid).hide();

            e.preventDefault();
            e.stopPropagation();
            return false;

        });

        $('body').on('click', '.loadallsubtask', function (e) {


            var element = $(this);

            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            var xid = del_id[1];

            var info = 'id=' + xid;



            $("#modalCon").load("DisplayAllSubTask?planner_id=" + xid);
            $('#Modal').modal('show');

            e.preventDefault();
            e.stopPropagation();
            return false;

        });


    </script>


    <div id="Modal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">

                    <h4 class="modal-title">List of Subtask</h4>
                </div>
                <div class="modal-body">
                    <div id="modalCon"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>


    <!-- new code for subtask v2-->

    <script>
        $('body').on('click', '.dplay2', function (e) {
            checktdnote();

            $('.hideall2').hide();

            //------
            $('.sel_cust').hide();
            $('.sel_cus').hide();
            $('.sel_stat').hide();
            $('.task_input2').show();
            //------

            var element = $(this);
            var id_string = element.attr("id");
            console.log(id_string);
            var del_id = id_string.split("_");
            var info = 'id=' + del_id[1];


            $('[id^=d2_]').each(function () {
                $(this).hide();
            });


            $('[id^=toogle2_]').each(function () {
                //  $(this).removeClass('remove_field2').addClass('dplay');
                $(this).show();
            });



            //enable delete field remove
            $('#toogle2_' + del_id[1]).hide();

            $('#d2_' + del_id[1]).show();

            $('#secondrow2_' + del_id[1]).show();

            e.preventDefault();
            e.stopPropagation();
            return false;

        });

        $("body").on('click', '.down_arrow2', function (e) {
            checktdnote();
            var element = $(this);
            var id_string = element.attr("id");
            var del_id = id_string.split("_");

            var control_name = del_id[0];
            console.log(id_string);

            $('.hideall2').hide();



            $('#secondrow2_' + del_id[1]).hide();

            $('#toogle2_' + del_id[1]).show();

            $('#d2_' + del_id[1]).hide();

            $('[id^=toogle2_]').each(function () {
                //  $(this).removeClass('remove_field2').addClass('dplay');
                $(this).show();
            });

            e.preventDefault();
            e.stopPropagation();
            return false;
        });


         $('body').on('click', '.require', function (e) {


            var href = $(this).attr('href');
        //    alert(href);

            var element = $(this);

            var id_string = element.attr("id");
            var del_id = id_string.split("_");
            var xid = del_id[1];

            var info = 'id=' + xid;


         //   var i = $('#projlist_' + xid).text();

            console.log(xid);


        //   $("#modalCon2").load("DisplayReq?planner_id=" +xid);
            var url = "@Url.Action("DisplayReq", "Admin")?planner_id=" + xid;
            $("#modalCon2").load(url);
           $('#Modal2').modal('show');

            e.preventDefault();
            e.stopPropagation();
            return false;

        });


        //------------- buttons

        $('body').on('click', '.btn_history', function () {
            let taskid = $(this).data("taskid");
            $('#mod_history').modal('show');
            $('.txt-history').val("");

            $(".btn_addtaskhistory").attr("data-taskid", taskid);
            $(".btn_fetchtaskhistory").attr("data-taskid", taskid);
            $(".btn_savetaskhistory").attr("data-taskid", taskid);

            $(".his_list").show();
            $(".his_form").hide();
            fetchTaskHistory(taskid);
        });

         function fetchTaskHistory(taskid){
                    let data = "id=" + taskid;
                    let url = "@Url.Action("FetchTaskHistory")";
                    let type = 'POST';
                    $.ajax({
                            type: type,
                            url: url,
                            data: data,
                            success: (data) => {

                                let html = '';
                                $(".his_items").html("");
                                data.forEach(function(historyItem){

                                    html = '';
                                    html += '<div style="clear: both; display: block; width: 100%; position: relative; margin-top: 0px; margin-bottom: 25px;">';
                                    html += '<div class="float-left">' + historyItem.datecreated + '</div>';
                                    html += '<button class="btn btn-danger btn-small btn_removetaskhistory float-right" data-taskid="' + taskid + '" data-historyid="' + historyItem.id + '" style="margin-right: 3px;">';
                                    html += 'Remove';
                                    html += '</button>';
                                    html += '</div>';
                                    html += '<br />';
                                    html += '<div class="td-main-xxx" style="clear: both; display: block; width: 100%; position: relative; border: 1px solid #eee; margin-top: 5px; margin-bottom: 5px;">';
                                    html += '   <div class="td-label">';
                                    html += '       <pre style="padding: 5px 5px 5px 5px;">';
                                    html += '           <xmp style="font-size: 12px; overflow: scroll; white-space:pre-wrap; word-wrap:break-word;">';
                                    html += historyItem.history;
                                    html += '           </xmp>';
                                    html += '       </pre>';
                                    html += '   </div>';

                                    html += '   <div class="td-control" data-type="txt" data-field="history" data-historyid="' + historyItem.id + '" style="display: none; width: 100%;">';
                                    html += '       <textarea class="td-txt txt-history txt_history" style="width: 100%; min-height: 400px; font-size: 12px; overflow: scroll; white-space:pre-wrap; word-wrap:break-word;">';
                                    html += historyItem.history;
                                    html += '       </textarea>';
                                    html += '   </div>';
                                    html += '</div>';

                                    $(".his_items").append(html);

                                });
                            }
                    });
             }
         $('body').on('click', '.img-thumbnail', function(){

             console.log('aaaaaaaaa');
            let base64 = $(this).attr("src");
            console.log(base64)
            $(".img_receiver").attr("src", base64);

        });

        $('body').on('click', '.btn_images', function(){
             let taskid = $(this).data('taskid');
             console.log("TASK ID" + taskid);
             $(".img_receiver").data("taskid", taskid);

             function loadTaskImages(taskid){
                    let data = "id=" + taskid;
                    let url = "@Url.Action("FetchTaskImages")";
                    let type = 'POST';

                    $.ajax({
                            type: type,
                            url: url,
                            data: data,
                            success: function (data) {
                                console.log(data);
                                console.log(data.length)
                                console.log(data[0].imagebase64);
                                console.dir(data[0]);

                                let imgx = '';
                                $(".img_list").html("");
                                data.forEach(function(d){

                                    imgx = '';
                                    imgx += '<div class="img_container" style="display: block; float: left; width: 120px;">';
                                    imgx += '<div style="float; right; position: absolute; display: inline-block; z-index: 9999;"><button class="btn_imageremove btn btn-danger btn-sm" data-imageid="' + d.id + '">x</button></div>';
                                    imgx += '<img src="@VirtualPathUtility.ToAbsolute("~/")Images/TaskImages/TaskImage-' + d.id + '.png" alt="" class="img-thumbnail" style="display: block; width: 120px; height: 120px;">';

                                    imgx += '</div>';

                                    $(".img_list").prepend(imgx);

                                });
                            }
                    });

             }

             loadTaskImages(taskid);
             $('#mod_images').modal('show');
             $(".img_receiver").attr("src", "");
             $(".img_list").html("");



        });

        //-------------------------------------------------------------------------
        // header JS code





        //------------------------------------------------------------------------

    </script>
    <div id="Modal" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">

                    <h4 class="modal-title">List of Subtask</h4>
                </div>
                <div class="modal-body">
                    <div id="modalCon"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>

    <div id="Modal2" class="modal fade" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">

                    <h4 class="modal-title">Requirements</h4>
                </div>
                <div class="modal-body">
                    <div id="modalCon2"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>

        </div>
    </div>

    <div class="modal fade" id="mod_images" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" style="width:90%">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Images</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" style="width: 100%;">
                    <div class="" data-taskid="0" style="background-image:  no-repeat center center fixed; background-size: cover; display: block; width: 100%; min-height: 400px; overflow: hidden; border: 1px solid #eee; margin-bottom: 20px;">
                        <img class="img_receiver" style="width: 100%; min-width: 400px; display: block;" />
                    </div>
                    <div class="img_list" style="background-image: no-repeat center center fixed; background-size: cover; display: block; width: 100%; height: 180px; border: 0 solid #eee;">
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="modal fade" id="mod_history" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" style="width:90%">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">History</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body" style="width: 100%;">
                    <div class="his_form" data-taskid="0" style="display: none; width: 100%; min-height: 400px; overflow: hidden;">
                        <textarea class="txt-history" style="width: 100%; display: block; height: 400px; border: 1px solid #eee; margin-bottom: 20px;">
                        </textarea>
                        <div style="display: block; clear: both; position: relative; width: 100%;">
                            <button class="btn btn-primary btn_savetaskhistory float-right" data-taskid="0" style="margin-left: 3px;">Save</button>
                            <button class="btn btn-danger btn_fetchtaskhistory float-right" data-taskid="0" style="margin-right: 3px;">Cancel</button>
                        </div>
                    </div>

                    <div class="his_list" data-taskid="0" style="display: none; width: 100%; min-height: 400px; overflow: scroll;">

                        <div class="his_items" style="display: block; width: 100%; min-height: 400px; overflow: scroll;">
                        </div>

                        <!--  <div style="display: block; clear: both; position: relative; width: 100%;">
                              <button class="btn btn-primary btn_addtaskhistory float-right" data-taskid="0">Add</button>
                          </div>-->
                    </div>
                </div>

            </div>
        </div>
    </div>


</body>
</html>